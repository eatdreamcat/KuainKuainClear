window.__require=function t(e,o,i){function n(r,s){if(!o[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+r+"'")}}var h=o[r]={exports:{}};e[r][0].call(h.exports,function(t){return n(e[r][1][t]||t)},h,h.exports,t,e,o,i)}return o[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<i.length;r++)n(i[r]);return n}({AudioController:[function(t,e,o){"use strict";cc._RF.push(e,"76488zQCU1KqLU6loyhNNZ5","AudioController"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../exts/HashMap"),n=t("./EventManager"),a=function(){function t(){this.curBgm=-1,this.curBgmName="",this.clips=new i.HashMap}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.init=function(t){console.warn(" start load AudioClip ");var e=this;cc.loader.loadResDir("AudioClip",cc.AudioClip,function(o,i,n){if(o)console.error(o);else{for(var a=0,r=i;a<r.length;a++){var s=r[a];e.clips.add(s.name,s)}e.initEvent(),t&&t()}})},t.prototype.initEvent=function(){n.gEventMgr.targetOff(this),this.curBgm=this.play("normal_bgm",!0,.7,!0),this.curBgmName="normal_bgm"},t.prototype.stop=function(e,o){if(t.canPlay)cc.audioEngine.stop(o);else for(var i=0,n=t.PlayedList;i<n.length;i++){var a=n[i];a.skip=a.clipName==e}},t.prototype.play=function(e,o,i,n){if(void 0===o&&(o=!1),void 0===i&&(i=1),void 0===n&&(n=!1),!t.canPlay&&!t.hasBindTouch){t.hasBindTouch=!0;var a=this,r=function(){var e;for(cc.game.canvas.removeEventListener("touchstart",r),t.canPlay=!0;(e=t.PlayedList.pop())&&a.clips.get(e.clipName)&&!e.skip;){var o=cc.audioEngine.play(a.clips.get(e.clipName),e.loop,e.volume);e.isBgm&&(a.curBgm=o),cc.audioEngine.setCurrentTime(o,(Date.now()-e.supTime)/1e3)}};cc.game.canvas.addEventListener("touchstart",r)}return this.clips.get(e)?t.canPlay?cc.audioEngine.play(this.clips.get(e),o,i):(t.PlayedList.push({clipName:e,loop:o,volume:i,supTime:Date.now(),skip:!1,isBgm:n}),-2):-1},t.PlayedList=[],t.canPlay=cc.sys.os.toLowerCase()!=cc.sys.OS_IOS.toLowerCase(),t.hasBindTouch=!1,t}();o.gAudio=a.inst,cc._RF.pop()},{"../exts/HashMap":"HashMap","./EventManager":"EventManager"}],Config:[function(t,e,o){"use strict";cc._RF.push(e,"7419cx/DDRG86x2LiwgMtL9","Config"),Object.defineProperty(o,"__esModule",{value:!0}),o.Config={GameID:216437,AppKey:"bc7b7fd603714d888deff0986e24f742#C",Secret:"6f86c9c856504b5d917dd06585553a3f",CocosAppID:"619821021",channel:"Matchvs",platform:"alpha",gameVersion:1,DeviceID:"1",MaxPlayer:2,isMultiPlayer:!1,FPS:60,WinSize:cc.size(1080,1920),Grid:cc.v2(8,8),GameTime:180},cc._RF.pop()},{}],CubeBg:[function(t,e,o){"use strict";cc._RF.push(e,"c1d5137ZNhJsZAlX67esxnT","CubeBg"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Controller/EventManager"),n=t("../Controller/EventName"),a=t("./GameMgr"),r=t("../Config/Config"),s=t("../TableMgr"),c=cc._decorator,l=c.ccclass,h=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cube=null,e.yingtao=null,e.pingguo=null,e.fanqie=null,e.mihoutao=null,e.boluo=null,e.chengzi=null,e.icon_daoju_B=null,e.icon_daoju_A=null,e.SpecialKill=null,e.index=0,e.OldFruitID=2e4,e.available=!1,e.preRowFlag=!1,e.preColFlag=!1,e.isPlaying=!1,e.isDirectlyKill=!1,e.isPlaySpecial=!1,e}return __extends(e,t),e.prototype.reuse=function(){this.isPlaying=!1,this.index=arguments[0][0],this.SpecialKill.node.active=!1,this.cube.node.active=!1,this.cube.node.opacity=255,this.node.runAction(cc.sequence(cc.scaleTo(0,.9),cc.scaleTo(.1,1.1),cc.scaleTo(.2,1),cc.callFunc(this.ready.bind(this),this))),this.initEvent()},e.prototype.ready=function(){this.setAvailable(!0)},e.prototype.unuse=function(){this.available=!1,i.gEventMgr.targetOff(this)},e.prototype.initEvent=function(){i.gEventMgr.targetOff(this),i.gEventMgr.on(n.GlobalEvent.CUBE_BOX_DRAG_CANCEL,this.onDragCancel,this),i.gEventMgr.on(n.GlobalEvent.CUBE_BOX_DRAG_INDEX,this.onDragIndex,this),i.gEventMgr.on(n.GlobalEvent.CUBE_BOX_PLACE_DONE,this.placeDone,this),i.gEventMgr.on(n.GlobalEvent.EAT_COL,this.eatCol,this),i.gEventMgr.on(n.GlobalEvent.EAT_ROW,this.eatRow,this),i.gEventMgr.on(n.GlobalEvent.KILL_DIRECTLY,this.killDirectly,this),i.gEventMgr.on(n.GlobalEvent.GAME_OVER,this.onGameOver,this),this.cube.getComponent(cc.Animation).on(cc.Animation.EventType.FINISHED,this.onKillFinished,this),this.SpecialKill.on(cc.Animation.EventType.FINISHED,this.onSpecialAniDone,this)},e.prototype.onGameOver=function(t){var e=this,o=t==a.OverType.NO_PLACE?this.fruitData.FailedIcon:this.fruitData.FrozenIcon;cc.loader.loadRes("Textures/Fruits/"+o,cc.SpriteFrame,function(t,o){t?console.error(" load fail icon failed:",t):e.cube.spriteFrame=o})},e.prototype.eatCol=function(t){if(!this.isAvailable())for(var e=0,o=t;e<o.length;e++){var i=o[e];if(this.index%r.Config.Grid.x==i){this.onKill(30*Math.floor(this.index/8));break}}},e.prototype.killDirectly=function(){this.isAvailable()||this.isDirectlyKill&&(this.isDirectlyKill=!1,this.onKill(this.index%8*30))},e.prototype.eatRow=function(t){if(!this.isAvailable())for(var e=0,o=t;e<o.length;e++){var i=o[e];if(this.index>=i*r.Config.Grid.x&&this.index<(i+1)*r.Config.Grid.x){this.onKill(this.index%8*30);break}}},e.prototype.onSpecialAniDone=function(){this.SpecialKill.node.active=!1},e.prototype.onKill=function(t){void 0===t&&(t=0),this.isPlaying=!0,a.Game.addScore(this.fruitData.Score),a.Game.addFruitKill(this.fruitData.ID),a.Game.addFruitScore(this.fruitData.ID,this.fruitData.Score);var e=this.fruitData.KillAni;i.gEventMgr.emit(n.GlobalEvent.ON_KILL),this.isPlaySpecial&&(this.isPlaySpecial=!1,this.SpecialKill.node.active=!0,this.SpecialKill.play("special_kill")),setTimeout(function(){this.isPlaying&&(this.cube.getComponent(cc.Animation).play(e,0).speed=1)}.bind(this),t),this.setAvailable(!0)},e.prototype.onKillFinished=function(){this.isPlaying=!1,this.isAvailable()&&(this.cube.node.active&&this.cube.node.opacity<255||(this.cube.node.active=!1,this.cube.node.opacity=255))},e.prototype.preCol=function(t){for(var e=0,o=t;e<o.length;e++){var i=o[e];if(this.index%r.Config.Grid.x==i){this.preColFlag=!0;break}this.preColFlag=!1}},e.prototype.preRow=function(t){for(var e=0,o=t;e<o.length;e++){var i=o[e];if(this.index>=i*r.Config.Grid.x&&this.index<(i+1)*r.Config.Grid.x){this.preRowFlag=!0;break}this.preRowFlag=!1}},e.prototype.onDragIndex=function(t,e,o,i){if(a.Game.isStart){if(o&&o.length>0?(this.isDirectlyKill=o.indexOf(this.index)>=0,a.Game.killDirectlyCount++):(this.isDirectlyKill=!1,a.Game.killDirectlyCount--),i&&i.length>0?this.isPlaySpecial=i.indexOf(this.index)>=0:this.isPlaySpecial=!1,this.available){var n=t.indexOf(this.index)>=0;this.cube.node.active=n||this.isPlaying,n&&(this.cube.node.opacity=150),this.cube.node.active&&this.cube.node.opacity<255?(a.Game.setPreCubeIndex(this.index,this.fruitData.Score),this.isPlaying&&(this.cube.getComponent(cc.Animation).stop(),this.isPlaying=!1),this.OldFruitID=a.Game.curSelectFruitID,this.updateFruitData(a.Game.curSelectFruitID)):a.Game.resetPreCubeIndex(this.index)}else t.indexOf(this.index)>=0&&a.Game.dragCount--,a.Game.setPreCubeIndex(this.index,this.fruitData.Score);this.preCheck()}},e.prototype.updateFruitData=function(t){this.fruitData=s.TableMgr.inst.getFruits(t),this.isPlaying||(this.cube.spriteFrame=this[this.fruitData.Icon])},e.prototype.preCheck=function(){var t=a.Game.checkRowCol(a.Game.getPreCubeIndex()),e=t[0],o=t[1];this.preRowFlag=!1,this.preColFlag=!1,o.length>0?this.preCol(o):this.preColFlag=!1,e.length>0?this.preRow(e):this.preRowFlag=!1;var i=s.TableMgr.inst.getFruits(a.Game.curSelectFruitID);i&&this.cube.node.active&&this.cube.node.opacity<255&&a.Game.addPreScore(i.BaseScore),(this.preRowFlag||this.preColFlag||this.isDirectlyKill)&&a.Game.addPreScore(i.Score),this.preRowFlag||this.preColFlag||this.isDirectlyKill?this.shake(!0):this.shake(!1)},e.prototype.shake=function(t){if(t){if(this.updateFruitData(a.Game.curSelectFruitID),this.cube.node.getNumberOfRunningActions()>0)return;var e=cc.repeatForever(cc.sequence(cc.rotateTo(.03,-4),cc.rotateTo(.03,0),cc.rotateBy(.03,4),cc.rotateTo(.03,0)));this.cube.node.runAction(e)}else this.cube.node.stopAllActions(),this.updateFruitData(this.OldFruitID),this.cube.node.rotation=0},e.prototype.getIndex=function(){return this.index},e.prototype.isAvailable=function(){return this.available},e.prototype.setAvailable=function(t){this.available!=t&&(this.available=t,this.available?(a.Game.resetCubeIndex(this.index),a.Game.resetPreCubeIndex(this.index),a.Game.addAvailableCount(1),this.cube.node.active=this.isPlaying):(a.Game.setCubeIndex(this.index,this.fruitData.Score),a.Game.setPreCubeIndex(this.index,this.fruitData.Score),a.Game.addAvailableCount(-1),this.cube.node.opacity=255,this.cube.getComponent(cc.Animation).stop(),this.isPlaying=!1,this.updateFruitData(a.Game.curSelectFruitID)),this.shake(!1))},e.prototype.placeDone=function(){a.Game.canPlace=!1,a.Game.resetPreScore(),this.available&&(this.cube.node.active&&this.cube.node.opacity<255?(this.setAvailable(!1),a.Game.curPlaceCount++,a.Game.addScore(this.fruitData.BaseScore),a.Game.addFruitScore(this.fruitData.ID,this.fruitData.BaseScore)):this.setAvailable(!0),console.log(a.Game.curPlaceCount,a.Game.dragCount),a.Game.curPlaceCount>=a.Game.dragCount&&a.Game.curPlaceCount>0&&(console.warn("place:",a.Game.curPlaceCount,a.Game.dragCount),a.Game.curPlaceCount=0,a.Game.dragCount=0,i.gEventMgr.emit(n.GlobalEvent.CUBE_BOX_SET_STATE_DONE)))},e.prototype.onDragCancel=function(){a.Game.resetPreScore(),this.available?(this.isPlaying||(this.cube.node.active=!1,this.cube.node.opacity=255),a.Game.dragCount=0):this.shake(!1)},e.prototype.onLoad=function(){},e.prototype.start=function(){},__decorate([h(cc.Sprite)],e.prototype,"cube",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u6a31\u6843"})],e.prototype,"yingtao",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u82f9\u679c"})],e.prototype,"pingguo",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u756a\u8304"})],e.prototype,"fanqie",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u7315\u7334\u6843"})],e.prototype,"mihoutao",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u83e0\u841d"})],e.prototype,"boluo",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u6a59\u5b50"})],e.prototype,"chengzi",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u4e5d\u5bab\u683c"})],e.prototype,"icon_daoju_B",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u6a2a\u7ad6"})],e.prototype,"icon_daoju_A",void 0),__decorate([h(cc.Animation)],e.prototype,"SpecialKill",void 0),e=__decorate([l],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../Config/Config":"Config","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../TableMgr":"TableMgr","./GameMgr":"GameMgr"}],CubeRoot:[function(t,e,o){"use strict";cc._RF.push(e,"b6abe/Y9ElKYballHwIR463","CubeRoot"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Controller/GameFactory"),n=t("../Controller/EventManager"),a=t("../Controller/EventName"),r=t("../Config/Config"),s=t("./GameMgr"),c=t("../TableMgr"),l=cc._decorator,h=l.ccclass,u=l.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.maxSize=cc.size(450,450),e.moveDetalTime=.1,e.layDetalTime=.02,e.dragSense=3,e.popOffset=cc.v2(100,50),e.popBaseY=400,e.scale=1,e.posRestored=cc.v2(0,0),e.isReady=!1,e.shapeData=null,e.fruitID=0,e.maxHorIndex=0,e.maxRow=0,e.endIndex=0,e.DragNode=null,e.PlaceNode=null,e}return __extends(e,t),e.prototype.reuse=function(){this.node.opacity=255,this.shapeData=arguments[0][0],this.node.width=0,this.node.height=0,this.node.zIndex=0,this.PlaceNode.width=0,this.PlaceNode.height=0,this.shapeData.shape.sort(function(t,e){return t-e});for(var t=r.Config.Grid.x,e=Math.floor(this.shapeData.shape[0]/t),o=0;o<this.shapeData.shape.length;o++)this.shapeData.shape[o]=this.shapeData.shape[o]%t+Math.max(Math.floor(this.shapeData.shape[o]/t-e),0)*t,this.maxHorIndex=Math.max(this.maxHorIndex,this.shapeData.shape[o]%r.Config.Grid.x);var n=this.shapeData.shape[this.shapeData.shape.length-1];this.maxRow=Math.max(1,Math.ceil(n/r.Config.Grid.x)),this.endIndex=(n-(this.maxRow-1)*r.Config.Grid.x)%r.Config.Grid.x,console.log(" endindex:",this.endIndex),this.endIndex=this.maxHorIndex-this.endIndex,console.log(" maxRow:",this.maxRow,", maxHorIndex:",this.maxHorIndex," ,endIndex:",this.endIndex),console.log(this.shapeData.shape),this.setFruit(),this.PlaceNode.removeAllChildren();for(var a=0,s=this.shapeData.shape;a<s.length;a++){var c=s[a];this.PlaceNode.addChild(i.gFactory.getCube(c,this.fruitID))}this.initEvent(),this.scheduleOnce(this.adjustPos.bind(this),0)},e.prototype.setFruit=function(){this.shapeStaticData=c.TableMgr.inst.getShape(this.shapeData.shapeID);for(var t=0,e=[],o=0,i=this.shapeStaticData.Fruit;o<i.length;o++){var n=i[o],a=parseInt(n.split("|")[0]),r=parseInt(n.split("|")[1]);t+=a,e.push({id:r,weight:t})}for(var s=CMath.getRandom()*t,l=0,h=e;l<h.length;l++){if((n=h[l]).weight>=s){this.fruitID=n.id;break}}console.log(" fruitID: ",this.fruitID)},e.prototype.unuse=function(){this.node.opacity=0,this.node.scale=1,n.gEventMgr.targetOff(this),this.node.targetOff(this),this.posRestored=cc.v2(0,0),this.node.x=0,this.node.y=0,this.scale=1,this.isReady=!1,this.maxHorIndex=0},e.prototype.initEvent=function(){n.gEventMgr.targetOff(this),n.gEventMgr.on(a.GlobalEvent.DRAG_ADJUST_DONE,this.restorePos,this),n.gEventMgr.on(a.GlobalEvent.GAME_OVER,this.gameOver,this)},e.prototype.gameOver=function(){s.Game.canPlace=!1,this.back()},e.prototype.restorePos=function(){this.posRestored.addSelf(this.node.position),console.log(this.posRestored)},e.prototype.adjustPos=function(){for(var t=0,e=this.PlaceNode.children;t<e.length;t++){var o=e[t];this.PlaceNode.width=Math.max(this.PlaceNode.width,o.x),this.PlaceNode.height=Math.max(this.PlaceNode.height,Math.abs(o.y))}this.PlaceNode.width+=this.PlaceNode.children[0].width,this.PlaceNode.height+=this.PlaceNode.children[0].height,this.node.width=this.PlaceNode.width,this.node.height=this.PlaceNode.height,this.scale=Math.min(1,this.maxSize.width/this.node.width,this.maxSize.height/this.node.height),this.node.scale=this.scale,this.DragNode.scale=1/this.scale;for(var i=0,r=this.PlaceNode.children;i<r.length;i++){(o=r[i]).x-=this.PlaceNode.width/2-o.width/2,o.y+=this.PlaceNode.height/2-o.height/2}this.node.y=0,n.gEventMgr.emit(a.GlobalEvent.Cube_ADJUST_DONE),this.boxSize=cc.size(this.node.width,this.node.height),this.cellSize=cc.size(this.PlaceNode.children[0].width,this.PlaceNode.children[0].height),this.DragNode.targetOff(this),this.DragNode.on(cc.Node.EventType.TOUCH_MOVE,this.onDrag,this),this.DragNode.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.DragNode.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.DragNode.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},e.prototype.onTouchStart=function(t){if(!this.isReady&&s.Game.canDrag&&s.Game.isStart){s.Game.resetPreScore();var e=this.DragNode.convertToNodeSpaceAR(t.getLocation()),o=cc.v2(e.x/this.DragNode.width*2,e.y/this.DragNode.height*2),i=cc.v2(this.node.x+this.popOffset.x*o.x,this.node.y+this.popBaseY+o.y*this.popOffset.y),n=1/this.node.parent.scale,a=cc.sequence(cc.spawn(cc.moveTo(this.moveDetalTime,i),cc.scaleTo(this.moveDetalTime,n)),cc.callFunc(this.ready.bind(this),this));this.node.stopAllActions(),this.node.zIndex=3,this.node.runAction(a),s.Game.curSelectFruitID=this.fruitID}},e.prototype.ready=function(){this.isReady=!0},e.prototype.reset=function(){this.isReady=!1,this.node.zIndex=1,s.Game.canDrag=!0},e.prototype.onTouchEnd=function(){if(s.Game.isStart)if(console.log(" end :",s.Game.canPlace),s.Game.canPlace){this.node.stopAllActions();var t=this.node.parent.convertToNodeSpaceAR(s.Game.placePos);this.node.runAction(cc.sequence(cc.moveTo(this.layDetalTime,t),cc.callFunc(this.placeDoneRoot.bind(this),this)))}else this.back()},e.prototype.back=function(){console.warn("posRestored:",this.posRestored);var t=cc.sequence(cc.spawn(cc.moveTo(this.moveDetalTime,this.posRestored),cc.scaleTo(this.moveDetalTime,this.scale)),cc.callFunc(this.reset.bind(this),this));this.node.stopAllActions(),this.node.runAction(t),n.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_DRAG_CANCEL)},e.prototype.placeDoneRoot=function(){for(s.Game.canDrag=!0,this.node.opacity=0;this.PlaceNode.children.length>0;)i.gFactory.putCube(this.PlaceNode.children[0]);i.gFactory.putCubeRoot(this.node),console.log(" Cube Root Place done !!!!!!"),n.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_PLACE_DONE)},e.prototype.onDrag=function(t){if(s.Game.canDrag&&s.Game.isStart&&this.isReady){s.Game.resetPreScore(),this.node.x+=t.getDeltaX()*this.dragSense,this.node.y+=t.getDeltaY()*this.dragSense;var e=s.Game.gamePanel.convertToNodeSpaceAR(this.node.parent.convertToWorldSpaceAR(this.node.position));n.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_DRAGING,e,[this.boxSize,this.cellSize],this.shapeData.shape,[this.endIndex,this.maxRow,this.maxHorIndex],this.shapeStaticData.ID)}},e.prototype.getInfo=function(){return[this.endIndex,this.maxRow,this.maxHorIndex]},e.prototype.getShape=function(){return this.shapeData.shape},e.prototype.getBoxSize=function(){return this.boxSize},e.prototype.getCellSize=function(){return this.cellSize},e.prototype.getShapeID=function(){return this.shapeStaticData.ID},e.prototype.onLoad=function(){},e.prototype.start=function(){},__decorate([u(cc.Node)],e.prototype,"DragNode",void 0),__decorate([u(cc.Node)],e.prototype,"PlaceNode",void 0),e=__decorate([h],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../Config/Config":"Config","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../Controller/GameFactory":"GameFactory","../TableMgr":"TableMgr","./GameMgr":"GameMgr"}],Cube:[function(t,e,o){"use strict";cc._RF.push(e,"2cc1c9ARLVAs4tu9Y4hLOzZ","Cube"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Config/Config"),n=t("../TableMgr"),a=cc._decorator,r=a.ccclass,s=(a.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.posIndex=0,e.fruitID=0,e}return __extends(e,t),e.prototype.reuse=function(){var t=this;this.posIndex=arguments[0][0],this.fruitID=arguments[0][1];var e=n.TableMgr.inst.getFruits(this.fruitID).Icon;cc.loader.loadRes("Textures/Fruits/"+e,cc.SpriteFrame,function(e,o){e?console.error("load fruit icon err:",e):t.getComponent(cc.Sprite).spriteFrame=o});var o=cc.v2(this.posIndex%i.Config.Grid.x*this.node.width,-Math.floor(this.posIndex/i.Config.Grid.y)*this.node.height);this.node.setPosition(o)},e.prototype.getIndex=function(){return this.posIndex},e.prototype.unuse=function(){this.posIndex=0,this.node.x=0,this.node.y=0,this.node.scale=1},e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.update=function(t){},e=__decorate([r],e)}(cc.Component));o.default=s,cc._RF.pop()},{"../Config/Config":"Config","../TableMgr":"TableMgr"}],EventManager:[function(t,e,o){"use strict";cc._RF.push(e,"3c384HeRO5DCL/qOmRM/SNf","EventManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){this.eventTarget=new cc.EventTarget}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.emit=function(t,e,o,i,n,a){this.eventTarget.emit(t.toString(),e,o,i,n,a)},t.prototype.on=function(t,e,o,i){return this.eventTarget.on(t.toString(),e,o,i)},t.prototype.once=function(t,e,o){this.eventTarget.once(t.toString(),e,o)},t.prototype.dispatchEvent=function(t){this.eventTarget.dispatchEvent(t)},t.prototype.off=function(t,e,o){this.eventTarget.off(t.toString(),e,o)},t.prototype.hasEventListener=function(t){return this.eventTarget.hasEventListener(t.toString())},t.prototype.targetOff=function(t){this.eventTarget.targetOff(t)},t}();o.gEventMgr=i.inst,cc._RF.pop()},{}],EventName:[function(t,e,o){"use strict";cc._RF.push(e,"cbeb5B1/2hLsYY0DvZwARsp","EventName"),Object.defineProperty(o,"__esModule",{value:!0}),function(t){t[t.Cube_ADJUST_DONE=0]="Cube_ADJUST_DONE",t[t.DRAG_ADJUST_DONE=1]="DRAG_ADJUST_DONE",t[t.CUBE_BOX_DRAGING=2]="CUBE_BOX_DRAGING",t[t.CUBE_BOX_DRAG_INDEX=3]="CUBE_BOX_DRAG_INDEX",t[t.CUBE_BOX_DRAG_CANCEL=4]="CUBE_BOX_DRAG_CANCEL",t[t.CUBE_BOX_PLACE_DONE=5]="CUBE_BOX_PLACE_DONE",t[t.CUBE_BOX_SET_STATE_DONE=6]="CUBE_BOX_SET_STATE_DONE",t[t.EAT_COL=7]="EAT_COL",t[t.EAT_ROW=8]="EAT_ROW",t[t.KILL_DIRECTLY=9]="KILL_DIRECTLY",t[t.UPDATE_SCORE=10]="UPDATE_SCORE",t[t.UPDATE_COMBO=11]="UPDATE_COMBO",t[t.GAME_OVER=12]="GAME_OVER",t[t.ON_KILL=13]="ON_KILL",t[t.ROW_EFFECT=14]="ROW_EFFECT",t[t.COL_EFFECT=15]="COL_EFFECT",t[t.SHOW_TEXT=16]="SHOW_TEXT",t[t.UPDATE_PRE_SCORE=17]="UPDATE_PRE_SCORE"}(o.GlobalEvent||(o.GlobalEvent={})),cc._RF.pop()},{}],GameBinder:[function(t,e,o){"use strict";cc._RF.push(e,"d22de/N1yxMwpFKClwORumF","GameBinder"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){}return t.bindAll=function(){},t}();o.default=i,cc._RF.pop()},{}],GameFactory:[function(t,e,o){"use strict";cc._RF.push(e,"e1ae9PPwO5MhJFqc7MS46ep","GameFactory"),Object.defineProperty(o,"__esModule",{value:!0});var i,n=t("../exts/HashMap"),a=function(){function t(t,e,o){this._pool=[],this.poolHandlerComps=[],this.poolHandlerComps=o,this.template=t,this.initPool(e)}return t.prototype.initPool=function(t){for(var e=0;e<t;++e){var o=cc.instantiate(this.template);this.put(o)}},t.prototype.size=function(){return this._pool.length},t.prototype.clear=function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy&&this._pool[e].destroy();this._pool.length=0},t.prototype.put=function(t){if(t&&-1===this._pool.indexOf(t)){if(t.removeFromParent(!1),this.poolHandlerComps)for(var e=0,o=this.poolHandlerComps;e<o.length;e++){var i=o[e],n=t.getComponent(i);n&&n.unuse&&n.unuse.apply(n)}else for(var a=0,r=t.getComponents(cc.Component);a<r.length;a++){(i=r[a])&&i.unuse&&i.unuse.apply(i)}this._pool.push(t)}},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this._pool.length-1;o<0&&(console.warn(" last < 0 "),this.initPool(1)),o=this._pool.length-1;var i=this._pool[o];if(this._pool.length=o,this.poolHandlerComps)for(var n=0,a=this.poolHandlerComps;n<a.length;n++){var r=a[n],s=i.getComponent(r);s&&s.reuse&&s.reuse.apply(s,arguments)}else for(var c=0,l=i.getComponents(cc.Component);c<l.length;c++){(r=l[c])&&r.reuse&&r.reuse.apply(r,arguments)}return i},t}();(function(t){t[t.INIT=0]="INIT",t[t.CUBE=4]="CUBE",t[t.CUBE_ROOT=8]="CUBE_ROOT",t[t.CUBE_BG=16]="CUBE_BG",t[t.DONE=28]="DONE"})(i||(i={}));var r=function(){function t(){this.step=i.INIT,this.CubeBgPool=new n.HashMap,this.CubePool=new n.HashMap,this.CubeRootPool=new n.HashMap}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.init=function(t){this.doneCallback=t,this.initCubeBg(1),this.initCube(1),this.initCubeRoot(1)},t.prototype.nextStep=function(t){this.step|=t,console.log("Factory Step:"+i[t]),this.step>=i.DONE&&this.doneCallback&&this.doneCallback()},t.prototype.initCubeBg=function(t){var e=this;cc.loader.loadRes("prefabs/CubeBg",cc.Prefab,function(o,n){o?console.error(o):(e.CubeBgPool.add("CubeBg",new a(n,t)),e.nextStep(i.CUBE_BG))})},t.prototype.getCubeBg=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.CubeBgPool.get("CubeBg").get(t)},t.prototype.putCubeBg=function(t){this.CubeBgPool.get("CubeBg").put(t)},t.prototype.initCube=function(t){var e=this;cc.loader.loadRes("prefabs/Cube",cc.Prefab,function(o,n){o?console.error(o):(e.CubePool.add("Cube",new a(n,t)),e.nextStep(i.CUBE))})},t.prototype.getCube=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.CubePool.get("Cube").get(t)},t.prototype.putCube=function(t){this.CubePool.get("Cube").put(t)},t.prototype.initCubeRoot=function(t){var e=this;cc.loader.loadRes("prefabs/CubeRoot",cc.Prefab,function(o,n){o?console.error(o):(e.CubeRootPool.add("CubeRoot",new a(n,t)),e.nextStep(i.CUBE_ROOT))})},t.prototype.getCubeRoot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.CubeRootPool.get("CubeRoot").get(t)},t.prototype.putCubeRoot=function(t){this.CubeRootPool.get("CubeRoot").put(t)},t}();o.gFactory=r.inst,cc._RF.pop()},{"../exts/HashMap":"HashMap"}],GameMgr:[function(t,e,o){"use strict";cc._RF.push(e,"004c8nxswRJr5F7AfDn0nPo","GameMgr"),Object.defineProperty(o,"__esModule",{value:!0});var i,n=t("../Config/Config"),a=t("../Controller/EventManager"),r=t("../Controller/EventName"),s=t("../exts/HashMap"),c=t("../TableMgr"),l=t("../table");(function(t){t[t.TIME_OUT=0]="TIME_OUT",t[t.NO_PLACE=1]="NO_PLACE"})(i=o.OverType||(o.OverType={}));var h=function(){function t(){this.gamePanel=null,this.dragPanel=null,this.data={totalScore:0,killCol:0,killRow:0,maxCombo:0,wildScore:0,fruitKill:{},fruitScore:{}},this.combo=0,this.time=n.Config.GameTime,this.canPlace=!1,this.placePos=cc.v2(0,0),this.canDrag=!0,this.isStart=!1,this.dragCount=0,this.curPlaceCount=0,this.availableCount=0,this.cubeIndex=[],this.preCubeIndex=[],this.curSelectFruitID=0,this.killDirectlyCount=0,this.shapeWeight=new s.HashMap,this.shapeTotalWeight=0,this.preScore=0}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.start=function(){var t=this;console.log("------------------------------- start ---------------------------"),this.time=n.Config.GameTime,this.addPreScore(-this.preScore),this.initData();for(var e=0;e<64;e++)this.cubeIndex.push(-Number.MAX_SAFE_INTEGER);var o=c.TableMgr.inst.getAll_ShapeWeight_Data();for(var i in o){var a=o[i];this.shapeWeight.add(parseInt(i),a.Weight)}this.shapeWeight.sort(function(t,e){return t.value-e.value}),this.shapeWeight.forEach(function(e,o){t.shapeTotalWeight+=o,t.shapeWeight.add(e,t.shapeTotalWeight)})},t.prototype.initData=function(){this.data.fruitKill={},this.data.fruitScore={},this.data.killCol=0,this.data.killRow=0,this.data.maxCombo=0,this.data.wildScore=0,this.addScore(-this.data.totalScore)},t.prototype.addFruitKill=function(t){this.data.fruitKill[t]?this.data.fruitKill[t]++:this.data.fruitKill[t]=1},t.prototype.addFruitScore=function(t,e){var o=c.TableMgr.inst.getFruits(t);o?(this.data.fruitScore[t]?this.data.fruitScore[t]+=e:this.data.fruitScore[t]=e,o.Type!=l.Fruits_Type.ShuiGuo&&(this.data.wildScore+=e)):console.error(" error fruitID: "+t)},t.prototype.addScore=function(t){this.data.totalScore+=t,a.gEventMgr.emit(r.GlobalEvent.UPDATE_SCORE)},t.prototype.getScore=function(){return this.data.totalScore},t.prototype.addKillCol=function(t){this.data.killCol+=t},t.prototype.addKillRow=function(t){this.data.killRow+=t},t.prototype.addCombo=function(t){this.combo+=t,this.combo>this.data.maxCombo&&(this.data.maxCombo=this.combo),this.combo>0&&a.gEventMgr.emit(r.GlobalEvent.UPDATE_COMBO),console.log(" --------------combo:",this.combo)},t.prototype.getCombo=function(){return this.combo},t.prototype.getShapes=function(){for(var t=[],e=0;e<3;e++){var o={shape:[],shapeID:0},i=CMath.getRandom(0,1)*this.shapeTotalWeight;console.log(" shapeWeight: ",i);for(var n=0,a=this.shapeWeight.values;n<a.length;n++){var r=a[n];if(r.value>=i){var s=c.TableMgr.inst.getShapeWeight(r.key),l=CMath.getRandom(0,1)*(s.ShapeList.length-1);console.warn(s,l),o.shapeID=s.ShapeList[Math.round(l)],o.shape=c.TableMgr.inst.getShape(o.shapeID).Shape,t.push(o);break}}}return console.log(t),t},t.prototype.getPreCubeIndex=function(){return this.preCubeIndex},t.prototype.getCubeIndex=function(){return this.cubeIndex},t.prototype.setCubeIndex=function(t,e){this.cubeIndex[t]=e},t.prototype.resetCubeIndex=function(t){this.cubeIndex[t]=-1e4},t.prototype.setPreCubeIndex=function(t,e){this.preCubeIndex[t]=e},t.prototype.resetPreCubeIndex=function(t){this.preCubeIndex[t]=-1e4},t.prototype.check=function(){var t=this.checkRowCol(this.cubeIndex),e=t[0],o=t[1],i=c.TableMgr.inst.getFruits(this.curSelectFruitID)||{Name:"\u8fa3\u9e21",Type:100};if(console.log("colIndex:",o,", rowIndex:",e," curFruit:",i.Name),a.gEventMgr.emit(r.GlobalEvent.EAT_COL,o),a.gEventMgr.emit(r.GlobalEvent.EAT_ROW,e),this.addKillRow(e.length),this.addKillCol(o.length),e.length>0||o.length>0||this.killDirectlyCount>0?this.addCombo(1):this.addCombo(-this.combo),i&&i.Type==l.Fruits_Type.ShuiGuo&&(e.length>0||o.length>0)&&(a.gEventMgr.emit(r.GlobalEvent.COL_EFFECT,o),a.gEventMgr.emit(r.GlobalEvent.ROW_EFFECT,e)),e.length>0||o.length>0||this.combo>0){var n="good";n=this.combo>=3?"unbelievable":this.combo>1?e.length<2&&o.length<2?"combo":"unbelievable":e.length<2&&o.length<2?"good":e.length<3&&o.length<3?"great":"amazing",a.gEventMgr.emit(r.GlobalEvent.SHOW_TEXT,n)}a.gEventMgr.emit(r.GlobalEvent.KILL_DIRECTLY)},t.prototype.checkRowCol=function(t){for(var e=[],o=[],i=0;i<n.Config.Grid.x;i++){for(var a=0,r=0,s=0;s<n.Config.Grid.y;s++)a+=t[s+i*n.Config.Grid.x],r+=t[i+s*n.Config.Grid.y];r>0&&e.push(i),a>0&&o.push(i)}return[o,e]},t.prototype.bindGamePanel=function(t){this.gamePanel=t},t.prototype.gameOver=function(t){console.error("game over"),this.isStart=!1,a.gEventMgr.emit(r.GlobalEvent.GAME_OVER,t),console.log(this.data)},t.prototype.addAvailableCount=function(t){this.availableCount+=t,0==this.isStart&&this.availableCount>=64&&(this.isStart=!0)},t.prototype.getAvailableCount=function(){return this.availableCount},t.prototype.update=function(t){this.isStart&&(this.time-=t,this.time<=0&&(this.time=0,this.isStart=!1,this.gameOver(i.TIME_OUT)))},t.prototype.getTime=function(){return this.time},t.prototype.addPreScore=function(t){this.preScore+=t,a.gEventMgr.emit(r.GlobalEvent.UPDATE_PRE_SCORE)},t.prototype.resetPreScore=function(){this.preScore=0,a.gEventMgr.emit(r.GlobalEvent.UPDATE_PRE_SCORE)},t.prototype.getPreScore=function(){return this.preScore},t}();o.Game=h.inst,cc._RF.pop()},{"../Config/Config":"Config","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../TableMgr":"TableMgr","../exts/HashMap":"HashMap","../table":"table"}],GameScene:[function(t,e,o){"use strict";cc._RF.push(e,"e4483cGN9dC8JpeMWEDWaJe","GameScene"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Controller/GameFactory"),n=t("../Controller/EventManager"),a=t("../Controller/EventName"),r=t("./GameMgr"),s=t("./CubeBg"),c=t("../Config/Config"),l=t("./CubeRoot"),h=t("../TableMgr"),u=t("../table"),p=cc._decorator,d=p.ccclass,g=p.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.GamePanel=null,e.DragPanel=null,e.Score=null,e.TimeLabel=null,e.TimeProgress=null,e.Player=null,e.RowEffect=null,e.ColEffect=null,e.ShowText=null,e.FloatScore=null,e.adjustCount=0,e.rowAnimation=[],e.colAnimation=[],e.floatScoreMoveSpeed=600,e.scorePos=cc.v2(350,95),e.score=0,e.canUpdateScore=!1,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;this.Score.string="0",this.FloatScore.string="",r.Game.start(),this.initEvent(),r.Game.bindGamePanel(this.GamePanel),this.GamePanel.removeAllChildren();for(var e=function(e){o.GamePanel.runAction(cc.sequence(cc.delayTime(e/60),cc.callFunc(function(){t.GamePanel.addChild(i.gFactory.getCubeBg(e))},o)))},o=this,n=0;n<=63;n++)e(n);this.DragPanel.removeAllChildren(),this.onCubePlaceDone(),this.Player.play("player_idle"),this.Player.on(cc.Animation.EventType.FINISHED,this.onAnimationFinish,this);for(var a=0,s=this.RowEffect.children;a<s.length;a++){var c=(u=s[a]).getComponent(cc.Animation);u.opacity=0,this.rowAnimation.push(c)}for(var l=0,h=this.ColEffect.children;l<h.length;l++){var u;c=(u=h[l]).getComponent(cc.Animation);u.opacity=0,this.colAnimation.push(c)}},e.prototype.initEvent=function(){n.gEventMgr.targetOff(this),n.gEventMgr.on(a.GlobalEvent.Cube_ADJUST_DONE,this.adjustDragPanel,this),n.gEventMgr.on(a.GlobalEvent.CUBE_BOX_DRAGING,this.onBoxDrag,this),n.gEventMgr.on(a.GlobalEvent.CUBE_BOX_SET_STATE_DONE,this.onCubePlaceDone,this),n.gEventMgr.on(a.GlobalEvent.UPDATE_SCORE,this.updateScore,this),n.gEventMgr.once(a.GlobalEvent.ON_KILL,this.onKill,this),n.gEventMgr.on(a.GlobalEvent.COL_EFFECT,this.colEffect,this),n.gEventMgr.on(a.GlobalEvent.ROW_EFFECT,this.rowEffect,this),n.gEventMgr.on(a.GlobalEvent.SHOW_TEXT,this.showText,this)},e.prototype.showText=function(t){console.log(" showText:",t),this.ShowText.play(t)},e.prototype.rowEffect=function(t){for(var e=0,o=t;e<o.length;e++){var i=o[e];this.rowAnimation[i]&&this.rowAnimation[i].play("kill_effect")}},e.prototype.colEffect=function(t){for(var e=0,o=t;e<o.length;e++){var i=o[e];this.colAnimation[i]&&this.colAnimation[i].play("kill_effect")}},e.prototype.onKill=function(){this.Player.play("player_kill")},e.prototype.onAnimationFinish=function(t,e){"player_kill"==e.name&&(this.Player.play("player_idle"),n.gEventMgr.once(a.GlobalEvent.ON_KILL,this.onKill,this))},e.prototype.updateScore=function(){},e.prototype.onBoxDrag=function(t,e,o,i,s){var c=e[0],l=e[1],h=t.add(cc.v2(-c.width/2+l.width/2,c.height/2-l.height/2));this.floatScorePos=cc.v2(t.x,t.y+80),r.Game.canPlace=this.checkCanPlace(t,h,o,i,s,!0),r.Game.canPlace?this.updateFloatScore():(this.FloatScore.string="",n.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_DRAG_CANCEL))},e.prototype.updateFloatScore=function(){r.Game.getPreScore()<=0?this.FloatScore.string="":(this.FloatScore.node.scale=1,this.FloatScore.string=r.Game.getPreScore().toString())},e.prototype.checkCanPlace=function(t,e,o,i,l,p){void 0===p&&(p=!1);for(var d=i[0],g=i[1],f=i[2],m=null,v=null,y=0,_=this.GamePanel.children;y<_.length;y++){var C=_[y];m?CMath.Distance(m.position,e)>=CMath.Distance(C.position,e)&&(m=C):CMath.Distance(C.position,e)<=C.width/2*Math.SQRT2&&(m=C)}if(!m)return!1;var b=m.getComponent(s.default).getIndex(),S=b+(g-1)*c.Config.Grid.x+f;if(S%c.Config.Grid.x>=b%c.Config.Grid.x)for(var E=0,D=this.GamePanel.children;E<D.length;E++){if((C=D[E]).getComponent(s.default).getIndex()==S){v=C;break}}if(v){var x=m.getComponent(s.default);if(x){for(var P=[],O=0,T=o;O<T.length;O++){var G=T[O],M=x.getIndex()+G;M<0||M>63||P.push(M)}if(P.length>0&&o.length==P.length){for(var A=null,R=0,I=this.GamePanel.children;R<I.length;R++){if((C=I[R]).getComponent(s.default).getIndex()==P[P.length-1]&&(A=C),!C.getComponent(s.default).isAvailable()&&P.indexOf(C.getComponent(s.default).getIndex())>=0)return!1}if(A&&v.getComponent(s.default).getIndex()%c.Config.Grid.x-A.getComponent(s.default).getIndex()%c.Config.Grid.x==d){if(p){var N=h.TableMgr.inst.getShape(l),w=[],F=[];if(N&&N.Type==u.Shape_Type.TeShuDaoJu){var B=P.length;if(N.RowKillNumber&&N.RowKillNumber>0)for(var U=0;U<B;U++)for(var L=P[U]-P[U]%8,k=L+7,K=L;K<=k;K++)P.indexOf(K)<0&&P.push(K);if(N.ColKillNumber&&N.ColKillNumber>0)for(U=0;U<B;U++){for(var H=P[U]+8;H<=63;)P.indexOf(H)<0&&P.push(H),H+=8;for(var W=P[U]-8;W>=0;)P.indexOf(W)<0&&P.push(W),W-=8}if(N.GridKill&&N.GridKill.length>0)for(var j=0,J=N.GridKill;j<J.length;j++){var z=J[j].split(","),X=parseInt(z[0]),q=parseInt(z[1]);for(U=0;U<B;U++){w.indexOf(P[U])<0&&w.push(P[U]),F.indexOf(P[U])<0&&F.push(P[U]),(G=P[U]+8*q+X)%8-P[U]%8==X&&(G>63||G<0||(P.indexOf(G)<0&&P.push(G),w.indexOf(G)<0&&w.push(G)))}}}r.Game.dragCount=P.length,n.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_DRAG_INDEX,P,l,w,F),r.Game.canPlace=!0,r.Game.placePos=this.GamePanel.convertToWorldSpaceAR(m.position.sub(e).add(t))}return!0}return!1}return!1}return!1}return!1},e.prototype.adjustDragPanel=function(){if(this.adjustCount++,console.log(this.adjustCount),this.adjustCount>=3){this.adjustCount=0;var t=this.DragPanel.children[1],e=this.DragPanel.children[0],o=this.DragPanel.children[2];t.x=0;var i=this.DragPanel.width/2;e.x=.6*i,o.x=.6*-i,n.gEventMgr.emit(a.GlobalEvent.DRAG_ADJUST_DONE)}},e.prototype.genNewDragShape=function(t){for(var e=0,o=t;e<o.length;e++){var n=o[e];this.DragPanel.addChild(i.gFactory.getCubeRoot(n))}},e.prototype.onCubePlaceDone=function(){if(this.FloatScore.node.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.moveTo(.2,this.scorePos),cc.callFunc(this.startUpdateScore.bind(this),this))),r.Game.check(),this.DragPanel.childrenCount<=0)this.genNewDragShape(r.Game.getShapes());else{for(var t=!0,e=0,o=this.DragPanel.children;e<o.length;e++)for(var i=o[e].getComponent(l.default),n=0,a=this.GamePanel.children;n<a.length;n++){var c=a[n];if(c.getComponent(s.default).isAvailable()&&this.checkCanPlace(c.position,c.position,i.getShape(),i.getInfo(),i.getShapeID())){t=!1;break}}t&&r.Game.gameOver(r.OverType.NO_PLACE)}},e.prototype.startUpdateScore=function(){this.canUpdateScore=!0,this.FloatScore.string="",this.FloatScore.node.scale=1,this.updateFloatScore()},e.prototype.update=function(t){if(r.Game.update(t),this.updateTime(),this.floatScorePos&&this.FloatScore.node.getNumberOfRunningActions()<=0){var e=this.floatScoreMoveSpeed*t;CMath.Distance(this.floatScorePos,this.FloatScore.node.position)>200&&(this.FloatScore.node.x=this.floatScorePos.x,this.FloatScore.node.y=this.floatScorePos.y),this.FloatScore.node.x>this.floatScorePos.x?this.FloatScore.node.x-=e:this.FloatScore.node.x<this.floatScorePos.x&&(this.FloatScore.node.x+=e),this.FloatScore.node.y>this.floatScorePos.y?this.FloatScore.node.y-=e:this.FloatScore.node.y<this.floatScorePos.y&&(this.FloatScore.node.y+=e),Math.abs(this.FloatScore.node.x-this.floatScorePos.x)<10&&(this.FloatScore.node.x=this.floatScorePos.x),Math.abs(this.FloatScore.node.y-this.floatScorePos.y)<10&&(this.FloatScore.node.y=this.floatScorePos.y)}this.canUpdateScore&&(this.score<r.Game.getScore()?this.score+=3:(this.canUpdateScore=!1,this.score=r.Game.getScore()),this.Score.string=this.score.toString())},e.prototype.updateTime=function(){this.TimeLabel.string=CMath.TimeFormat(r.Game.getTime()),this.TimeProgress.progress=r.Game.getTime()/c.Config.GameTime},__decorate([g(cc.Node)],e.prototype,"GamePanel",void 0),__decorate([g(cc.Node)],e.prototype,"DragPanel",void 0),__decorate([g(cc.Label)],e.prototype,"Score",void 0),__decorate([g(cc.Label)],e.prototype,"TimeLabel",void 0),__decorate([g(cc.ProgressBar)],e.prototype,"TimeProgress",void 0),__decorate([g(cc.Animation)],e.prototype,"Player",void 0),__decorate([g(cc.Node)],e.prototype,"RowEffect",void 0),__decorate([g(cc.Node)],e.prototype,"ColEffect",void 0),__decorate([g(cc.Animation)],e.prototype,"ShowText",void 0),__decorate([g(cc.Label)],e.prototype,"FloatScore",void 0),e=__decorate([d],e)}(cc.Component);o.default=f,cc._RF.pop()},{"../Config/Config":"Config","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../Controller/GameFactory":"GameFactory","../TableMgr":"TableMgr","../table":"table","./CubeBg":"CubeBg","./CubeRoot":"CubeRoot","./GameMgr":"GameMgr"}],HashMap:[function(t,e,o){"use strict";cc._RF.push(e,"65ec9+rOt5Kur9SeJbgRgUM","HashMap"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){this._list=new Array,this.clear()}return t.prototype.getIndexByKey=function(t){for(var e=this._list.length,o=0;o<e;o++){if(this._list[o].key==t)return o}return-1},Object.defineProperty(t.prototype,"keys",{get:function(){for(var t=new Array,e=0,o=this._list;e<o.length;e++){var i=o[e];i&&t.push(i.key)}return t},enumerable:!0,configurable:!0}),t.prototype.add=function(t,e){var o={key:t,value:e},i=this.getIndexByKey(t);-1!=i?this._list[i]=o:this._list.push(o)},Object.defineProperty(t.prototype,"values",{get:function(){return this._list},enumerable:!0,configurable:!0}),t.prototype.remove=function(t){var e=this.getIndexByKey(t);if(-1!=e){var o=this._list[e];return this._list.splice(e,1),o}return null},t.prototype.has=function(t){return-1!=this.getIndexByKey(t)},t.prototype.get=function(t){var e=this.getIndexByKey(t);return-1!=e?this._list[e].value:null},Object.defineProperty(t.prototype,"length",{get:function(){return this._list.length},enumerable:!0,configurable:!0}),t.prototype.sort=function(t){this._list.sort(t)},t.prototype.forEachKeyValue=function(t){for(var e=this._list.length,o=0;o<e;o++){t(this._list[o])}},t.prototype.forEach=function(t){for(var e=this._list.length,o=0;o<e;o++){var i=this._list[o];t(i.key,i.value)}},t.prototype.clear=function(){this._list=[]},t}();o.HashMap=i,cc._RF.pop()},{}],OverWindowBinder:[function(t,e,o){"use strict";cc._RF.push(e,"aa2ee5OmJRDj7s00KSFN+Qa","OverWindowBinder"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){}return t.bindAll=function(){},t}();o.default=i,cc._RF.pop()},{}],TableMgr:[function(t,e,o){"use strict";cc._RF.push(e,"33c73L3v+BDpLtcNY7gOVEB","TableMgr"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){this.load=t.JSON_URL&&""!=t.JSON_URL?cc.loader.load.bind(cc.loader):cc.loader.loadRes.bind(cc.loader),this.fileFormat=t.JSON_URL&&""!=t.JSON_URL?".json?time="+Date.now():"",this.total=0,this.complete=0,this.Fruits={},this.Shape={},this.ShapeWeight={}}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.startLoad=function(e,o,i){this.completeCallback=o,this.progressCallback=i;var n=this;console.log("Base URL:",t.JSON_URL),this.load(t.JSON_URL+e.trim().split("/").join("")+"/file_list"+this.fileFormat,function(t,o){if(t)console.error(t.errorMessage);else{var i="Array"==o.constructor.name?o:o.json;this.total=i.length;for(var a=0,r=i;a<r.length;a++){var s=r[a];n.loadJson(e.trim().split("/").join("")+"/"+s.replace(".json",""))}}}.bind(this))},t.prototype.loadJson=function(e){console.log("start load:"+e);var o=this,i=e.split("/")[1];i=i.charAt(0).toUpperCase()+i.slice(1,i.length),this.load(t.JSON_URL+e+this.fileFormat,function(t,e){if(t)console.error(t.errorMessage);else{for(var n=0,a="Array"==e.constructor.name?e:e.json;n<a.length;n++){var r=a[n];o[i][r.ID]=r}o.completeLoad()}}.bind(this))},t.prototype.completeLoad=function(){this.complete++,this.complete>=this.total&&this.completeCallback&&this.completeCallback()},t.prototype.getFruits=function(t){return this.Fruits[t]?this.Fruits[t]:(console.error("Fruits \u4e0d\u5b58key\uff1a"+t),null)},t.prototype.getAll_Fruits_Data=function(){return this.Fruits},t.prototype.getShape=function(t){return this.Shape[t]?this.Shape[t]:(console.error("Shape \u4e0d\u5b58key\uff1a"+t),null)},t.prototype.getAll_Shape_Data=function(){return this.Shape},t.prototype.getShapeWeight=function(t){return this.ShapeWeight[t]?this.ShapeWeight[t]:(console.error("ShapeWeight \u4e0d\u5b58key\uff1a"+t),null)},t.prototype.getAll_ShapeWeight_Data=function(){return this.ShapeWeight},t.JSON_URL="",t}();o.TableMgr=i,cc._RF.pop()},{}],UIManager:[function(t,e,o){"use strict";cc._RF.push(e,"77177WRAQdM2bTfZ/1vIPzs","UIManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../exts/HashMap"),n=t("../UI/export/Game/GameBinder"),a=t("../UI/export/OverWindow/OverWindowBinder"),r=cc._decorator.ccclass,s=function(){function t(){this.isInit=!1,this.guiMap=new i.HashMap,this.windowMap=new i.HashMap}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.init=function(){fgui.addLoadHandler(),cc.view.setResizeCallback(this.onResize.bind(this)),cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,function(){fgui.GRoot.create(),console.info("########################### fgui.GRoot.create ###########################")},this),this.isInit=!0},t.prototype.loadUIPackage=function(t){console.warn(" start load loadUIPackage "),this.isInit||this.init(),this.windowMap.clear(),this.guiMap.clear(),fgui.UIPackage._instById={},cc.loader.loadResDir("UI/sync",function(e,o,i){if(console.log(i),e)t(e);else{for(var r=0,s=i;r<s.length;r++){var c=s[r];/atlas/.test(c)||fgui.UIPackage.addPackage(c)}n.default.bindAll(),a.default.bindAll(),t(null)}})},t.prototype.onResize=function(){var t=cc.view.getCanvasSize();t.width/=cc.view.getScaleX(),t.height/=cc.view.getScaleY(),this.guiMap.forEach(function(e,o){o.setPosition((t.width-o.width)/2,(t.height-o.height)/2)}),this.windowMap.forEach(function(e,o){o.setPosition((t.width-o.width)/2,(t.height-o.height)/2)})},t.prototype.openGUI=function(t,e){var o=this.guiMap.get(t.URL);if(o){var i=o.node.getComponent(e);return o.node.active?console.warn("UI is showed:"+t.URL):i.show(),i}var n=t.createInstanceSync();return n.setPosition((fgui.GRoot.inst.width-n.width)/2,(fgui.GRoot.inst.height-n.height)/2),fgui.GRoot.inst.addChild(n),this.guiMap.add(t.URL,n),n.node.addComponent(e).register(n).show()},t.prototype.closeGUI=function(t,e){var o=this.guiMap.get(t.URL);return o?o.node.getComponent(e).hide():(console.error("UI not exist:"+t.URL),null)},t.prototype.openWindow=function(t,e){var o=this,i=this.windowMap.get(t.URL);if(i){var n=i.node.getComponent(e);i.node.active?console.warn("UI is showed:"+t.URL):n.show()}else t.createInstance(function(i){var n=new fgui.Window;n.contentPane=i,n.modal=!0,n.show(),n.setPosition((fgui.GRoot.inst.width-n.width)/2,(fgui.GRoot.inst.height-n.height)/2),o.windowMap.add(t.URL,n),n.node.addComponent(e).register(i).show()})},t.prototype.closeWindow=function(t,e,o){void 0===o&&(o=!0);var i=this.windowMap.get(t.URL);if(!i)return console.error("UI not exist:"+t.URL),!1;i.hide();var n=i.node.getComponent(e).hide(o);return o&&t.releaseInstance(),this.windowMap.remove(t.URL),n},t}();o.UIMgr=s.inst;var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onShow=function(){},e.prototype.onHide=function(){},e.prototype.show=function(){return this.node.isValid?(this.node.active||(this.node.active=!0),this.onShow(),this):(console.error(" node valid!"),this)},e.prototype.hide=function(t){return void 0===t&&(t=!1),this.node.isValid?(this.node.active&&(this.node.active=!1),this.onHide(),t&&this.node.removeFromParent(t),!0):(console.error(" node valid!"),!1)},e=__decorate([r],e)}(cc.Component);o.BaseUI=c,cc._RF.pop()},{"../UI/export/Game/GameBinder":"GameBinder","../UI/export/OverWindow/OverWindowBinder":"OverWindowBinder","../exts/HashMap":"HashMap"}],WelcomeScene:[function(t,e,o){"use strict";cc._RF.push(e,"cc976drFj5NmKgolSm1G3Qa","WelcomeScene"),Object.defineProperty(o,"__esModule",{value:!0});var i,n=t("../TableMgr"),a=t("../Controller/AudioController"),r=t("../Controller/GameFactory"),s=t("../Config/Config"),c=t("../exts/celerx"),l=cc._decorator,h=l.ccclass,u=l.property;(function(t){t[t.READY=2]="READY",t[t.INIT=4]="INIT",t[t.REGISTER=8]="REGISTER",t[t.LOGIN=16]="LOGIN",t[t.MATCH=32]="MATCH",t[t.JSON_PARSE=64]="JSON_PARSE",t[t.ANIMATION_DONE=128]="ANIMATION_DONE",t[t.SCENE_DONE=256]="SCENE_DONE",t[t.AUDIO=512]="AUDIO",t[t.UI=1024]="UI",t[t.CELER=2048]="CELER",t[t.DONE=4094]="DONE"})(i=o.LOAD_STEP||(o.LOAD_STEP={}));var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.nextSceneName="game",e.percentLabel=null,e.maxPercent=0,e.curPercent=0,e._step=i.READY,e.startTime=0,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;c.ready(),CMath.randomSeed=Date.now();var e=this;c.onStart(function(){e.celerStart()}),this.celerStart(),this.startTime=Date.now(),cc.game.setFrameRate(s.Config.FPS),this.maxPercent=0,this.defaultAnimation=this.node.getComponent(cc.Animation),this.defaultAnimation?this.defaultAnimation.once(cc.Animation.EventType.FINISHED,this.animationDone,this):this.nextStep(i.ANIMATION_DONE),s.Config.isMultiPlayer||(this.nextStep(i.LOGIN),this.nextStep(i.MATCH),this.nextStep(i.REGISTER),this.nextStep(i.INIT)),cc.loader.loadResDir("Textures/Fruits/"),n.TableMgr.inst.startLoad("json/",function(){r.gFactory.init(function(){this.nextStep(i.JSON_PARSE)}.bind(t))}),a.gAudio.init(function(){this.nextStep(i.AUDIO)}.bind(this)),cc.director.preloadScene(this.nextSceneName,null,function(e,o){e?console.error("\u573a\u666f\u52a0\u8f7d\u9519\u8bef"):(t.nextScene=o.scene,t.nextStep(i.SCENE_DONE))}),this.nextStep(i.UI)},e.prototype.celerStart=function(){var t=c.getMatch();t&&t.sharedRandomSeed?CMath.randomSeed=t.sharedRandomSeed:CMath.randomSeed=Date.now(),this.nextStep(i.CELER)},e.prototype.update=function(t){this.curPercent+=t/10,this.curPercent>=this.maxPercent&&(this.curPercent=this.maxPercent),this.percentLabel.string=(100*this.curPercent).toFixed(2)+"%",this.curPercent>=1&&this.node.emit("load_done")},e.prototype.animationDone=function(){this.defaultAnimation.off(cc.Animation.EventType.FINISHED),this.nextStep(i.ANIMATION_DONE)},e.prototype.nextStep=function(t){var e=this;this.calLoadTime(t),this._step|=t,t!=i.ANIMATION_DONE&&console.log("CUR STEP:"+i[t]+", total: "+this._step),this.maxPercent=(this._step&(65535^i.ANIMATION_DONE))/(i.DONE&(65535^i.ANIMATION_DONE)),this._step>=i.DONE?(this.node.once("load_done",function(){e.nextScene?cc.director.runSceneImmediate(e.nextScene):cc.director.loadScene(e.nextSceneName)},this),this.defaultAnimation&&(this.defaultAnimation.play().wrapMode=cc.WrapMode.Loop)):t==i.ANIMATION_DONE&&this.defaultAnimation&&(this._step&=65535^i.ANIMATION_DONE,this.defaultAnimation.once(cc.Animation.EventType.FINISHED,this.animationDone,this),this.defaultAnimation.play())},e.prototype.calLoadTime=function(t){switch(t){case i.AUDIO:console.warn(" audio cost time:",Date.now()-this.startTime,"ms");break;case i.JSON_PARSE:console.warn(" table cost time:",Date.now()-this.startTime,"ms");break;case i.UI:console.warn(" UI cost time:",Date.now()-this.startTime,"ms");break;case i.SCENE_DONE:console.warn(" Scene cost time:",Date.now()-this.startTime,"ms")}},__decorate([u({displayName:"\u6e38\u620f\u573a\u666f\u540d",tooltip:"\u9ed8\u8ba4\u8fdb\u5165game\u573a\u666f\uff0c\u5982\u679c\u9700\u8981\u6307\u5b9a\u573a\u666f\uff0c\u53ef\u4ee5\u6307\u5b9a"})],e.prototype,"nextSceneName",void 0),__decorate([u(cc.Label)],e.prototype,"percentLabel",void 0),e=__decorate([h],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../Config/Config":"Config","../Controller/AudioController":"AudioController","../Controller/GameFactory":"GameFactory","../TableMgr":"TableMgr","../exts/celerx":"celerx"}],celerx:[function(t,e,o){"use strict";cc._RF.push(e,"5fb9cBc1OBEM5BpUwBtd5fb","celerx");var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function n(t){for(var e=new Uint8Array(t),o=new Array,i=0,n=0,a=new Array(3),r=new Array(4),s=e.length,l=0;s--;)if(a[i++]=e[l++],3==i){for(r[0]=(252&a[0])>>2,r[1]=((3&a[0])<<4)+((240&a[1])>>4),r[2]=((15&a[1])<<2)+((192&a[2])>>6),r[3]=63&a[2],i=0;i<4;i++)o+=c.charAt(r[i]);i=0}if(i){for(n=i;n<3;n++)a[n]=0;for(r[0]=(252&a[0])>>2,r[1]=((3&a[0])<<4)+((240&a[1])>>4),r[2]=((15&a[1])<<2)+((192&a[2])>>6),r[3]=63&a[2],n=0;n<i+1;n++)o+=c.charAt(r[n]);for(;i++<3;)o+="="}return o}function a(t){var e,o,i,n,a,r,s=new Array,c=0;if(t!=(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""))&&alert("Warning! Characters outside Base64 range in input string ignored."),t.length%4)return alert("Error: Input length is not a multiple of 4 bytes."),"";for(var h=0;c<t.length;)e=l.indexOf(t.charAt(c++))<<2|(n=l.indexOf(t.charAt(c++)))>>4,o=(15&n)<<4|(a=l.indexOf(t.charAt(c++)))>>2,i=(3&a)<<6|(r=l.indexOf(t.charAt(c++))),s[h++]=e,64!=a&&(s[h++]=o),64!=r&&(s[h++]=i);return s}var r="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(t){return void 0===t?"undefined":i(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":i(t)},s={default:void 0,call:function(t,e,o){var i="";if("function"==typeof e&&(o=e,e={}),e={data:void 0===e?null:e},"function"==typeof o){var n="dscb"+window.dscb++;window[n]=o,e._dscbstub=n}return e=JSON.stringify(e),window._dsbridge?i=_dsbridge.call(t,e):(window._dswk||-1!=navigator.userAgent.indexOf("_dsbridge"))&&(i=prompt("_dsbridge="+t,e)),JSON.parse(i||"{}").data},register:function(t,e,o){o=o?window._dsaf:window._dsf,window._dsInit||(window._dsInit=!0,setTimeout(function(){s.call("_dsb.dsinit")},0)),"object"==(void 0===e?"undefined":r(e))?o._obs[t]=e:o[t]=e},registerAsyn:function(t,e){this.register(t,e,!0)},hasNativeMethod:function(t,e){return this.call("_dsb.hasNativeMethod",{name:t,type:e||"all"})},disableJavascriptDialogBlock:function(t){this.call("_dsb.disableJavascriptDialogBlock",{disable:!1!==t})}};!function(){if(!window._dsf){var t,e={_dsf:{_obs:{}},_dsaf:{_obs:{}},dscb:0,celerx:s,close:function(){s.call("_dsb.closePage")},_handleMessageFromNative:function(t){var e=JSON.parse(t.data),o={id:t.callbackId,complete:!0},i=this._dsf[t.method],n=this._dsaf[t.method],a=function(t,i){o.data=t.apply(i,e),s.call("_dsb.returnValue",o)},r=function(t,i){e.push(function(t,e){o.data=t,o.complete=!1!==e,s.call("_dsb.returnValue",o)}),t.apply(i,e)};if(i)a(i,this._dsf);else if(n)r(n,this._dsaf);else if(!(2>(i=t.method.split(".")).length)){t=i.pop();i=i.join(".");var c=(n=(n=this._dsf._obs)[i]||{})[t];c&&"function"==typeof c?a(c,n):(c=(n=(n=this._dsaf._obs)[i]||{})[t])&&"function"==typeof c&&r(c,n)}}};for(t in e)window[t]=e[t];s.register("_hasJavascriptMethod",function(t,e){return 2>(e=t.split(".")).length?!(!_dsf[e]&&!_dsaf[e]):(t=e.pop(),e=e.join("."),(e=_dsf._obs[e]||_dsaf._obs[e])&&!!e[t])})}}();var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.exports={onStateReceived:function(t){return s.register("onStateReceived",function(e){var o=a(e);return t(new Uint8Array(o))})},onCourtModeStarted:function(t){return s.register("onCourtModeStarted",t)},getMatch:function(){var t=s.call("getMatch","123");try{t=JSON.parse(t)}catch(t){}return t},showCourtModeDialog:function(){return s.call("showCourtModeDialog")},start:function(){return s.call("start")},sendState:function(t){return s.call("sendState",n(t))},draw:function(t){return s.call("draw",n(t))},win:function(t){return s.call("win",n(t))},lose:function(t){return s.call("lose",n(t))},surrender:function(t){return s.call("surrender",n(t))},applyAction:function(t,e){return s.call("applyAction",n(t),e)},getOnChainState:function(t){return s.call("getOnChainState","123",function(e){var o=a(e);return t(new Uint8Array(o))})},getOnChainActionDeadline:function(t){return s.call("getOnChainActionDeadline","123",t)},getCurrentBlockNumber:function(){return s.call("getCurrentBlockNumber","123")},finalizeOnChainGame:function(t){return s.call("finalizeOnChainGame","123",t)},submitScore:function(t){return s.call("submitScore",t)},ready:function(){return s.call("ready")},onStart:function(t){return s.register("onStart",t)}},cc._RF.pop()},{}],table:[function(t,e,o){"use strict";cc._RF.push(e,"adcebipSrZMgb1UHOlwts9Z","table"),Object.defineProperty(o,"__esModule",{value:!0}),function(t){t[t.ShuiGuo=1]="ShuiGuo",t[t.DaoJu=2]="DaoJu"}(o.Fruits_Type||(o.Fruits_Type={})),function(t){t[t.PuTongFangKuai=1]="PuTongFangKuai",t[t.TeShuDaoJu=2]="TeShuDaoJu"}(o.Shape_Type||(o.Shape_Type={})),cc._RF.pop()},{}]},{},["Config","AudioController","EventManager","EventName","GameFactory","UIManager","Cube","CubeBg","CubeRoot","GameMgr","GameScene","WelcomeScene","TableMgr","GameBinder","OverWindowBinder","HashMap","celerx","table"]);