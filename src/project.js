window.__require=function e(t,o,n){function i(r,s){if(!o[r]){if(!t[r]){var c=r.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+r+"'")}}var h=o[r]={exports:{}};t[r][0].call(h.exports,function(e){return i(t[r][1][e]||e)},h,h.exports,e,t,o,n)}return o[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<n.length;r++)i(n[r]);return i}({AudioController:[function(e,t,o){"use strict";cc._RF.push(t,"76488zQCU1KqLU6loyhNNZ5","AudioController"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../exts/HashMap"),i=e("./EventManager"),a=function(){function e(){this.curBgm=-1,this.curBgmName="",this.clips=new n.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e){console.warn(" start load AudioClip ");var t=this;cc.loader.loadResDir("AudioClip",cc.AudioClip,function(o,n,i){if(o)console.error(o);else{for(var a=0,r=n;a<r.length;a++){var s=r[a];t.clips.add(s.name,s)}t.initEvent(),e&&e()}})},e.prototype.initEvent=function(){i.gEventMgr.targetOff(this),this.curBgm=this.play("normal_bgm",!0,.7,!0),this.curBgmName="normal_bgm"},e.prototype.stop=function(t,o){if(e.canPlay)cc.audioEngine.stop(o);else for(var n=0,i=e.PlayedList;n<i.length;n++){var a=i[n];a.skip=a.clipName==t}},e.prototype.play=function(t,o,n,i){if(void 0===o&&(o=!1),void 0===n&&(n=1),void 0===i&&(i=!1),!e.canPlay&&!e.hasBindTouch){e.hasBindTouch=!0;var a=this,r=function(){var t;for(cc.game.canvas.removeEventListener("touchstart",r),e.canPlay=!0;(t=e.PlayedList.pop())&&a.clips.get(t.clipName)&&!t.skip;){var o=cc.audioEngine.play(a.clips.get(t.clipName),t.loop,t.volume);t.isBgm&&(a.curBgm=o),cc.audioEngine.setCurrentTime(o,(Date.now()-t.supTime)/1e3)}};cc.game.canvas.addEventListener("touchstart",r)}return this.clips.get(t)?e.canPlay?cc.audioEngine.play(this.clips.get(t),o,n):(e.PlayedList.push({clipName:t,loop:o,volume:n,supTime:Date.now(),skip:!1,isBgm:i}),-2):-1},e.PlayedList=[],e.canPlay=cc.sys.os.toLowerCase()!=cc.sys.OS_IOS.toLowerCase(),e.hasBindTouch=!1,e}();o.gAudio=a.inst,cc._RF.pop()},{"../exts/HashMap":"HashMap","./EventManager":"EventManager"}],Config:[function(e,t,o){"use strict";cc._RF.push(t,"7419cx/DDRG86x2LiwgMtL9","Config"),Object.defineProperty(o,"__esModule",{value:!0}),o.Config={GameID:216437,AppKey:"bc7b7fd603714d888deff0986e24f742#C",Secret:"6f86c9c856504b5d917dd06585553a3f",CocosAppID:"619821021",channel:"Matchvs",platform:"alpha",gameVersion:1,DeviceID:"1",MaxPlayer:2,isMultiPlayer:!1,FPS:60,WinSize:cc.size(1080,1920),Grid:cc.v2(8,8),GameTime:180},cc._RF.pop()},{}],CubeBg:[function(e,t,o){"use strict";cc._RF.push(t,"c1d5137ZNhJsZAlX67esxnT","CubeBg"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Controller/EventManager"),i=e("../Controller/EventName"),a=e("./GameMgr"),r=e("../Config/Config"),s=e("../TableMgr"),c=cc._decorator,l=c.ccclass,h=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cube=null,t.yingtao=null,t.pingguo=null,t.fanqie=null,t.mihoutao=null,t.boluo=null,t.chengzi=null,t.index=0,t.OldFruitID=2e4,t.available=!1,t.preRowFlag=!1,t.preColFlag=!1,t.isPlaying=!1,t}return __extends(t,e),t.prototype.reuse=function(){this.isPlaying=!1,this.index=arguments[0][0],this.cube.node.active=!1,this.cube.node.opacity=255,this.node.runAction(cc.sequence(cc.scaleTo(0,.9),cc.scaleTo(.1,1.1),cc.scaleTo(.2,1),cc.callFunc(this.ready.bind(this),this))),this.initEvent()},t.prototype.ready=function(){this.setAvailable(!0)},t.prototype.unuse=function(){this.available=!1,n.gEventMgr.targetOff(this)},t.prototype.initEvent=function(){n.gEventMgr.targetOff(this),n.gEventMgr.on(i.GlobalEvent.CUBE_BOX_DRAG_CANCEL,this.onDragCancel,this),n.gEventMgr.on(i.GlobalEvent.CUBE_BOX_DRAG_INDEX,this.onDragIndex,this),n.gEventMgr.on(i.GlobalEvent.CUBE_BOX_PLACE_DONE,this.placeDone,this),n.gEventMgr.on(i.GlobalEvent.EAT_COL,this.eatCol,this),n.gEventMgr.on(i.GlobalEvent.EAT_ROW,this.eatRow,this),n.gEventMgr.on(i.GlobalEvent.GAME_OVER,this.onGameOver,this),this.cube.getComponent(cc.Animation).on(cc.Animation.EventType.FINISHED,this.onKillFinished,this)},t.prototype.onGameOver=function(e){var t=this,o=e==a.OverType.NO_PLACE?this.fruitData.FailedIcon:this.fruitData.FrozenIcon;cc.loader.loadRes("Textures/Fruits/"+o,cc.SpriteFrame,function(e,o){e?console.error(" load fail icon failed:",e):t.cube.spriteFrame=o})},t.prototype.eatCol=function(e){if(!this.isAvailable())for(var t=0,o=e;t<o.length;t++){var n=o[t];if(this.index%r.Config.Grid.x==n){this.onKill(20*Math.floor(this.index/8));break}}},t.prototype.eatRow=function(e){if(!this.isAvailable())for(var t=0,o=e;t<o.length;t++){var n=o[t];if(this.index>=n*r.Config.Grid.x&&this.index<(n+1)*r.Config.Grid.x){this.onKill(this.index%8*20);break}}},t.prototype.onKill=function(e){void 0===e&&(e=0),this.isPlaying=!0,a.Game.addScore(this.fruitData.Score);var t=this.fruitData.KillAni;setTimeout(function(){this.isPlaying&&(this.cube.getComponent(cc.Animation).play(t,0).speed=1)}.bind(this),e),this.setAvailable(!0)},t.prototype.onKillFinished=function(){this.isPlaying=!1,this.isAvailable()&&(this.cube.node.active&&this.cube.node.opacity<255||(this.cube.node.active=!1,this.cube.node.opacity=255))},t.prototype.preCol=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];if(this.index%r.Config.Grid.x==n){this.preColFlag=!0;break}this.preColFlag=!1}},t.prototype.preRow=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];if(this.index>=n*r.Config.Grid.x&&this.index<(n+1)*r.Config.Grid.x){this.preRowFlag=!0;break}this.preRowFlag=!1}},t.prototype.onDragIndex=function(e){if(this.available){var t=e.indexOf(this.index)>=0;this.cube.node.active=t||this.isPlaying,t&&(this.cube.node.opacity=150),this.cube.node.active&&this.cube.node.opacity<255?(a.Game.setPreCubeIndex(this.index,this.fruitData.Score),this.isPlaying&&(this.cube.getComponent(cc.Animation).stop(),this.isPlaying=!1),this.OldFruitID=a.Game.curSelectFruitID,this.updateFruitData(a.Game.curSelectFruitID)):a.Game.resetPreCubeIndex(this.index)}else a.Game.setPreCubeIndex(this.index,this.fruitData.Score);this.preCheck(),a.Game.dragCount=e.length},t.prototype.updateFruitData=function(e){this.fruitData=s.TableMgr.inst.getFruits(e),this.isPlaying||(this.cube.spriteFrame=this[this.fruitData.Icon])},t.prototype.preCheck=function(){var e=a.Game.checkRowCol(a.Game.getPreCubeIndex()),t=e[0],o=e[1];this.preRowFlag=!1,this.preColFlag=!1,o.length>0?this.preCol(o):this.preColFlag=!1,t.length>0?this.preRow(t):this.preRowFlag=!1,this.preRowFlag||this.preColFlag?this.shake(!0):this.shake(!1)},t.prototype.shake=function(e){if(this.cube.node.stopAllActions(),e&&!this.isAvailable()){if(this.updateFruitData(a.Game.curSelectFruitID),this.cube.node.getNumberOfRunningActions()>0)return;var t=cc.repeatForever(cc.sequence(cc.rotateTo(.03,-4),cc.rotateTo(.03,0),cc.rotateBy(.03,4),cc.rotateTo(.03,0)));this.cube.node.runAction(t)}else this.updateFruitData(this.OldFruitID),this.cube.node.rotation=0},t.prototype.getIndex=function(){return this.index},t.prototype.isAvailable=function(){return this.available},t.prototype.setAvailable=function(e){this.available!=e&&(this.available=e,this.available?(a.Game.resetCubeIndex(this.index),a.Game.resetPreCubeIndex(this.index),a.Game.addAvailableCount(1),this.cube.node.active=this.isPlaying):(a.Game.setCubeIndex(this.index,this.fruitData.Score),a.Game.setPreCubeIndex(this.index,this.fruitData.Score),a.Game.addAvailableCount(-1),this.cube.node.opacity=255,this.cube.getComponent(cc.Animation).stop(),this.isPlaying=!1,this.updateFruitData(a.Game.curSelectFruitID)),this.shake(!1))},t.prototype.placeDone=function(){a.Game.canPlace=!1,this.available&&(this.cube.node.active&&this.cube.node.opacity<255?(this.setAvailable(!1),a.Game.curPlaceCount++):this.setAvailable(!0),a.Game.curPlaceCount>=a.Game.dragCount&&a.Game.curPlaceCount>0&&(console.warn("place:",a.Game.curPlaceCount,a.Game.dragCount),a.Game.curPlaceCount=0,a.Game.dragCount=0,n.gEventMgr.emit(i.GlobalEvent.CUBE_BOX_SET_STATE_DONE)))},t.prototype.onDragCancel=function(){this.available?(this.isPlaying||(this.cube.node.active=!1,this.cube.node.opacity=255),a.Game.dragCount=0):this.shake(!1)},t.prototype.onLoad=function(){},t.prototype.start=function(){},__decorate([h(cc.Sprite)],t.prototype,"cube",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u6a31\u6843"})],t.prototype,"yingtao",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u82f9\u679c"})],t.prototype,"pingguo",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u756a\u8304"})],t.prototype,"fanqie",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u7315\u7334\u6843"})],t.prototype,"mihoutao",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u83e0\u841d"})],t.prototype,"boluo",void 0),__decorate([h({type:cc.SpriteFrame,displayName:"\u6a59\u5b50"})],t.prototype,"chengzi",void 0),t=__decorate([l],t)}(cc.Component);o.default=u,cc._RF.pop()},{"../Config/Config":"Config","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../TableMgr":"TableMgr","./GameMgr":"GameMgr"}],CubeRoot:[function(e,t,o){"use strict";cc._RF.push(t,"b6abe/Y9ElKYballHwIR463","CubeRoot"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Controller/GameFactory"),i=e("../Controller/EventManager"),a=e("../Controller/EventName"),r=e("../Config/Config"),s=e("./GameMgr"),c=e("../TableMgr"),l=cc._decorator,h=l.ccclass,u=l.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.maxSize=cc.size(450,450),t.moveDetalTime=.1,t.layDetalTime=.02,t.dragSense=2,t.popOffset=cc.v2(100,50),t.popBaseY=400,t.scale=1,t.posRestored=cc.v2(0,0),t.isReady=!1,t.shapeData=null,t.fruitID=0,t.maxHorIndex=0,t.maxRow=0,t.endIndex=0,t.DragNode=null,t.PlaceNode=null,t}return __extends(t,e),t.prototype.reuse=function(){this.node.opacity=255,this.shapeData=arguments[0][0],this.node.width=0,this.node.height=0,this.PlaceNode.width=0,this.PlaceNode.height=0,this.shapeData.shape.sort(function(e,t){return e-t});for(var e=r.Config.Grid.x,t=Math.floor(this.shapeData.shape[0]/e),o=0;o<this.shapeData.shape.length;o++)this.shapeData.shape[o]=this.shapeData.shape[o]%e+Math.max(Math.floor(this.shapeData.shape[o]/e-t),0)*e,this.maxHorIndex=Math.max(this.maxHorIndex,this.shapeData.shape[o]%r.Config.Grid.x);var i=this.shapeData.shape[this.shapeData.shape.length-1];this.maxRow=Math.max(1,Math.ceil(i/r.Config.Grid.x)),this.endIndex=(i-(this.maxRow-1)*r.Config.Grid.x)%r.Config.Grid.x,console.log(" endindex:",this.endIndex),this.endIndex=this.maxHorIndex-this.endIndex,console.log(" maxRow:",this.maxRow,", maxHorIndex:",this.maxHorIndex," ,endIndex:",this.endIndex),console.log(this.shapeData.shape),this.setFruit(),this.PlaceNode.removeAllChildren();for(var a=0,s=this.shapeData.shape;a<s.length;a++){var c=s[a];this.PlaceNode.addChild(n.gFactory.getCube(c,this.fruitID))}this.initEvent(),this.scheduleOnce(this.adjustPos.bind(this),0)},t.prototype.setFruit=function(){for(var e=0,t=[],o=0,n=c.TableMgr.inst.getShape(this.shapeData.shapeID).Fruit;o<n.length;o++){var i=n[o],a=parseInt(i.split("|")[0]),r=parseInt(i.split("|")[1]);e+=a,t.push({id:r,weight:e})}for(var s=CMath.getRandom()*e,l=0,h=t;l<h.length;l++){if((i=h[l]).weight>=s){this.fruitID=i.id;break}}console.log(" fruitID: ",this.fruitID)},t.prototype.unuse=function(){this.node.opacity=0,this.node.scale=1,i.gEventMgr.targetOff(this),this.node.targetOff(this),this.posRestored=cc.v2(0,0),this.node.x=0,this.node.y=0,this.scale=1,this.isReady=!1,this.maxHorIndex=0},t.prototype.initEvent=function(){i.gEventMgr.targetOff(this),i.gEventMgr.on(a.GlobalEvent.DRAG_ADJUST_DONE,this.restorePos,this)},t.prototype.restorePos=function(){this.posRestored.addSelf(this.node.position),console.log(this.posRestored)},t.prototype.adjustPos=function(){for(var e=0,t=this.PlaceNode.children;e<t.length;e++){var o=t[e];this.PlaceNode.width=Math.max(this.PlaceNode.width,o.x),this.PlaceNode.height=Math.max(this.PlaceNode.height,Math.abs(o.y))}this.PlaceNode.width+=this.PlaceNode.children[0].width,this.PlaceNode.height+=this.PlaceNode.children[0].height,this.node.width=this.PlaceNode.width,this.node.height=this.PlaceNode.height,this.scale=Math.min(1,this.maxSize.width/this.node.width,this.maxSize.height/this.node.height),this.node.scale=this.scale,this.DragNode.scale=1/this.scale;for(var n=0,r=this.PlaceNode.children;n<r.length;n++){(o=r[n]).x-=this.PlaceNode.width/2-o.width/2,o.y+=this.PlaceNode.height/2-o.height/2}this.node.y=0,i.gEventMgr.emit(a.GlobalEvent.Cube_ADJUST_DONE),this.boxSize=cc.size(this.node.width,this.node.height),this.cellSize=cc.size(this.PlaceNode.children[0].width,this.PlaceNode.children[0].height),this.DragNode.targetOff(this),this.DragNode.on(cc.Node.EventType.TOUCH_MOVE,this.onDrag,this),this.DragNode.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.DragNode.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.DragNode.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},t.prototype.onTouchStart=function(e){if(!this.isReady&&s.Game.canDrag&&s.Game.isStart){var t=this.DragNode.convertToNodeSpaceAR(e.getLocation()),o=cc.v2(t.x/this.DragNode.width*2,t.y/this.DragNode.height*2),n=cc.v2(this.node.x+this.popOffset.x*o.x,this.node.y+this.popBaseY+o.y*this.popOffset.y),i=1/this.node.parent.scale,a=cc.sequence(cc.spawn(cc.moveTo(this.moveDetalTime,n),cc.scaleTo(this.moveDetalTime,i)),cc.callFunc(this.ready.bind(this),this));this.node.stopAllActions(),this.node.zIndex=3,this.node.runAction(a),s.Game.curSelectFruitID=this.fruitID}},t.prototype.ready=function(){this.isReady=!0},t.prototype.reset=function(){this.isReady=!1,this.node.zIndex=1,s.Game.canDrag=!0},t.prototype.onTouchEnd=function(e){if(s.Game.isStart)if(console.log(" end :",s.Game.canPlace),s.Game.canPlace){this.node.stopAllActions();var t=this.node.parent.convertToNodeSpaceAR(s.Game.placePos);this.node.runAction(cc.sequence(cc.moveTo(this.layDetalTime,t),cc.callFunc(this.placeDoneRoot.bind(this),this)))}else{console.warn("posRestored:",this.posRestored);var o=cc.sequence(cc.spawn(cc.moveTo(this.moveDetalTime,this.posRestored),cc.scaleTo(this.moveDetalTime,this.scale)),cc.callFunc(this.reset.bind(this),this));this.node.stopAllActions(),this.node.runAction(o),i.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_DRAG_CANCEL)}},t.prototype.placeDoneRoot=function(){for(s.Game.canDrag=!0,this.node.opacity=0;this.PlaceNode.children.length>0;)n.gFactory.putCube(this.PlaceNode.children[0]);n.gFactory.putCubeRoot(this.node),console.log(" Cube Root Place done !!!!!!"),i.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_PLACE_DONE)},t.prototype.onDrag=function(e){if(s.Game.canDrag&&this.isReady){this.node.x+=e.getDeltaX()*this.dragSense,this.node.y+=e.getDeltaY()*this.dragSense;var t=s.Game.gamePanel.convertToNodeSpaceAR(this.node.parent.convertToWorldSpaceAR(this.node.position));i.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_DRAGING,t,this.boxSize,this.cellSize,this.shapeData.shape,[this.endIndex,this.maxRow,this.maxHorIndex])}},t.prototype.getInfo=function(){return[this.endIndex,this.maxRow,this.maxHorIndex]},t.prototype.getShape=function(){return this.shapeData.shape},t.prototype.getBoxSize=function(){return this.boxSize},t.prototype.getCellSize=function(){return this.cellSize},t.prototype.onLoad=function(){},t.prototype.start=function(){},__decorate([u(cc.Node)],t.prototype,"DragNode",void 0),__decorate([u(cc.Node)],t.prototype,"PlaceNode",void 0),t=__decorate([h],t)}(cc.Component);o.default=p,cc._RF.pop()},{"../Config/Config":"Config","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../Controller/GameFactory":"GameFactory","../TableMgr":"TableMgr","./GameMgr":"GameMgr"}],Cube:[function(e,t,o){"use strict";cc._RF.push(t,"2cc1c9ARLVAs4tu9Y4hLOzZ","Cube"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Config/Config"),i=e("../TableMgr"),a=cc._decorator,r=a.ccclass,s=(a.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.posIndex=0,t.fruitID=0,t}return __extends(t,e),t.prototype.reuse=function(){var e=this;this.posIndex=arguments[0][0],this.fruitID=arguments[0][1];var t=i.TableMgr.inst.getFruits(this.fruitID).Icon;cc.loader.loadRes("Textures/Fruits/"+t,cc.SpriteFrame,function(t,o){t?console.error("load fruit icon err:",t):e.getComponent(cc.Sprite).spriteFrame=o});var o=cc.v2(this.posIndex%n.Config.Grid.x*this.node.width,-Math.floor(this.posIndex/n.Config.Grid.y)*this.node.height);this.node.setPosition(o)},t.prototype.getIndex=function(){return this.posIndex},t.prototype.unuse=function(){this.posIndex=0,this.node.x=0,this.node.y=0,this.node.scale=1},t.prototype.onLoad=function(){},t.prototype.start=function(){},t.prototype.update=function(e){},t=__decorate([r],t)}(cc.Component));o.default=s,cc._RF.pop()},{"../Config/Config":"Config","../TableMgr":"TableMgr"}],EventManager:[function(e,t,o){"use strict";cc._RF.push(t,"3c384HeRO5DCL/qOmRM/SNf","EventManager"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this.eventTarget=new cc.EventTarget}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.emit=function(e,t,o,n,i,a){this.eventTarget.emit(e.toString(),t,o,n,i,a)},e.prototype.on=function(e,t,o,n){return this.eventTarget.on(e.toString(),t,o,n)},e.prototype.once=function(e,t,o){this.eventTarget.once(e.toString(),t,o)},e.prototype.dispatchEvent=function(e){this.eventTarget.dispatchEvent(e)},e.prototype.off=function(e,t,o){this.eventTarget.off(e.toString(),t,o)},e.prototype.hasEventListener=function(e){return this.eventTarget.hasEventListener(e.toString())},e.prototype.targetOff=function(e){this.eventTarget.targetOff(e)},e}();o.gEventMgr=n.inst,cc._RF.pop()},{}],EventName:[function(e,t,o){"use strict";cc._RF.push(t,"cbeb5B1/2hLsYY0DvZwARsp","EventName"),Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.Cube_ADJUST_DONE=0]="Cube_ADJUST_DONE",e[e.DRAG_ADJUST_DONE=1]="DRAG_ADJUST_DONE",e[e.CUBE_BOX_DRAGING=2]="CUBE_BOX_DRAGING",e[e.CUBE_BOX_DRAG_INDEX=3]="CUBE_BOX_DRAG_INDEX",e[e.CUBE_BOX_DRAG_CANCEL=4]="CUBE_BOX_DRAG_CANCEL",e[e.CUBE_BOX_PLACE_DONE=5]="CUBE_BOX_PLACE_DONE",e[e.CUBE_BOX_SET_STATE_DONE=6]="CUBE_BOX_SET_STATE_DONE",e[e.EAT_COL=7]="EAT_COL",e[e.EAT_ROW=8]="EAT_ROW",e[e.UPDATE_SCORE=9]="UPDATE_SCORE",e[e.UPDATE_COMBO=10]="UPDATE_COMBO",e[e.GAME_OVER=11]="GAME_OVER"}(o.GlobalEvent||(o.GlobalEvent={})),cc._RF.pop()},{}],GameBinder:[function(e,t,o){"use strict";cc._RF.push(t,"d22de/N1yxMwpFKClwORumF","GameBinder"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){}return e.bindAll=function(){},e}();o.default=n,cc._RF.pop()},{}],GameFactory:[function(e,t,o){"use strict";cc._RF.push(t,"e1ae9PPwO5MhJFqc7MS46ep","GameFactory"),Object.defineProperty(o,"__esModule",{value:!0});var n,i=e("../exts/HashMap"),a=function(){function e(e,t,o){this._pool=[],this.poolHandlerComps=[],this.poolHandlerComps=o,this.template=e,this.initPool(t)}return e.prototype.initPool=function(e){for(var t=0;t<e;++t){var o=cc.instantiate(this.template);this.put(o)}},e.prototype.size=function(){return this._pool.length},e.prototype.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy&&this._pool[t].destroy();this._pool.length=0},e.prototype.put=function(e){if(e&&-1===this._pool.indexOf(e)){if(e.removeFromParent(!1),this.poolHandlerComps)for(var t=0,o=this.poolHandlerComps;t<o.length;t++){var n=o[t],i=e.getComponent(n);i&&i.unuse&&i.unuse.apply(i)}else for(var a=0,r=e.getComponents(cc.Component);a<r.length;a++){(n=r[a])&&n.unuse&&n.unuse.apply(n)}this._pool.push(e)}},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this._pool.length-1;o<0&&(console.warn(" last < 0 "),this.initPool(10)),o=this._pool.length-1;var n=this._pool[o];if(this._pool.length=o,this.poolHandlerComps)for(var i=0,a=this.poolHandlerComps;i<a.length;i++){var r=a[i],s=n.getComponent(r);s&&s.reuse&&s.reuse.apply(s,arguments)}else for(var c=0,l=n.getComponents(cc.Component);c<l.length;c++){(r=l[c])&&r.reuse&&r.reuse.apply(r,arguments)}return n},e}();(function(e){e[e.INIT=0]="INIT",e[e.CUBE=4]="CUBE",e[e.CUBE_ROOT=8]="CUBE_ROOT",e[e.CUBE_BG=16]="CUBE_BG",e[e.DONE=28]="DONE"})(n||(n={}));var r=function(){function e(){this.step=n.INIT,this.CubeBgPool=new i.HashMap,this.CubePool=new i.HashMap,this.CubeRootPool=new i.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e){this.doneCallback=e,this.initCubeBg(),this.initCube(),this.initCubeRoot()},e.prototype.nextStep=function(e){this.step|=e,console.log("Factory Step:"+n[e]),this.step>=n.DONE&&this.doneCallback&&this.doneCallback()},e.prototype.initCubeBg=function(){var e=this;cc.loader.loadRes("prefabs/CubeBg",cc.Prefab,function(t,o){if(t)console.error(t);else{var i=cc.instantiate(o);e.CubeBgPool.add("CubeBg",new a(i,64)),e.nextStep(n.CUBE_BG)}})},e.prototype.getCubeBg=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.CubeBgPool.get("CubeBg").get(e)},e.prototype.putCubeBg=function(e){this.CubeBgPool.get("CubeBg").put(e)},e.prototype.initCube=function(){var e=this;cc.loader.loadRes("prefabs/Cube",cc.Prefab,function(t,o){if(t)console.error(t);else{var i=cc.instantiate(o);e.CubePool.add("Cube",new a(i,64)),e.nextStep(n.CUBE)}})},e.prototype.getCube=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.CubePool.get("Cube").get(e)},e.prototype.putCube=function(e){this.CubePool.get("Cube").put(e)},e.prototype.initCubeRoot=function(){var e=this;cc.loader.loadRes("prefabs/CubeRoot",cc.Prefab,function(t,o){if(t)console.error(t);else{var i=cc.instantiate(o);e.CubeRootPool.add("CubeRoot",new a(i,30)),e.nextStep(n.CUBE_ROOT)}})},e.prototype.getCubeRoot=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.CubeRootPool.get("CubeRoot").get(e)},e.prototype.putCubeRoot=function(e){this.CubeRootPool.get("CubeRoot").put(e)},e}();o.gFactory=r.inst,cc._RF.pop()},{"../exts/HashMap":"HashMap"}],GameMgr:[function(e,t,o){"use strict";cc._RF.push(t,"004c8nxswRJr5F7AfDn0nPo","GameMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n,i=e("../Config/Config"),a=e("../Controller/EventManager"),r=e("../Controller/EventName"),s=e("../exts/HashMap"),c=e("../TableMgr");(function(e){e[e.TIME_OUT=0]="TIME_OUT",e[e.NO_PLACE=1]="NO_PLACE"})(n=o.OverType||(o.OverType={}));var l=function(){function e(){this.gamePanel=null,this.dragPanel=null,this.score=0,this.combo=0,this.time=i.Config.GameTime,this.canPlace=!1,this.placePos=cc.v2(0,0),this.canDrag=!0,this.isStart=!1,this.dragCount=0,this.curPlaceCount=0,this.availableCount=0,this.cubeIndex=[],this.preCubeIndex=[],this.curSelectFruitID=0,this.shapeWeight=new s.HashMap,this.shapeTotalWeight=0}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.start=function(){var e=this;console.log("------------------------------- start ---------------------------"),this.time=i.Config.GameTime,this.addScore(-this.score);for(var t=0;t<64;t++)this.cubeIndex.push(-Number.MAX_SAFE_INTEGER);var o=c.TableMgr.inst.getAll_ShapeWeight_Data();for(var n in o){var a=o[n];this.shapeWeight.add(parseInt(n),a.Weight)}this.shapeWeight.sort(function(e,t){return e.value-t.value}),this.shapeWeight.forEach(function(t,o){e.shapeTotalWeight+=o,e.shapeWeight.add(t,e.shapeTotalWeight)})},e.prototype.addScore=function(e){this.score+=e,a.gEventMgr.emit(r.GlobalEvent.UPDATE_SCORE)},e.prototype.getScore=function(){return this.score},e.prototype.addCombo=function(e){this.combo+=e,a.gEventMgr.emit(r.GlobalEvent.UPDATE_COMBO)},e.prototype.getCombo=function(){return this.combo},e.prototype.getShapes=function(){for(var e=[],t=0;t<3;t++){var o={shape:[],shapeID:0},n=CMath.getRandom(0,1)*this.shapeTotalWeight;console.log(" shapeWeight: ",n);for(var i=0,a=this.shapeWeight.values;i<a.length;i++){var r=a[i];if(r.value>=n){var s=c.TableMgr.inst.getShapeWeight(r.key);console.log(s),o.shapeID=s.ShapeList[Math.ceil(CMath.getRandom(0,1)*(s.ShapeList.length-1))],o.shape=c.TableMgr.inst.getShape(o.shapeID).Shape,e.push(o);break}}}return console.log(e),e},e.prototype.getPreCubeIndex=function(){return this.preCubeIndex},e.prototype.getCubeIndex=function(){return this.cubeIndex},e.prototype.setCubeIndex=function(e,t){this.cubeIndex[e]=t},e.prototype.resetCubeIndex=function(e){this.cubeIndex[e]=-Date.now()%100-600},e.prototype.setPreCubeIndex=function(e,t){this.preCubeIndex[e]=t},e.prototype.resetPreCubeIndex=function(e){this.preCubeIndex[e]=-Date.now()%100-100*parseFloat(CMath.getRandom().toFixed(1))-500},e.prototype.check=function(){var e=this.checkRowCol(this.cubeIndex),t=e[0],o=e[1];console.log("colIndex:",o,", rowIndex:",t),a.gEventMgr.emit(r.GlobalEvent.EAT_COL,o),a.gEventMgr.emit(r.GlobalEvent.EAT_ROW,t)},e.prototype.checkRowCol=function(e){for(var t=[],o=[],n=0;n<i.Config.Grid.x;n++){for(var a=0,r=0,s=0;s<i.Config.Grid.y;s++)a+=e[s+n*i.Config.Grid.x],r+=e[n+s*i.Config.Grid.y];r>0&&t.push(n),a>0&&o.push(n)}return[o,t]},e.prototype.bindGamePanel=function(e){this.gamePanel=e},e.prototype.gameOver=function(e){console.error("game over"),this.isStart=!1,a.gEventMgr.emit(r.GlobalEvent.GAME_OVER,e)},e.prototype.addAvailableCount=function(e){this.availableCount+=e,0==this.isStart&&this.availableCount>=64&&(this.isStart=!0)},e.prototype.getAvailableCount=function(){return this.availableCount},e.prototype.update=function(e){this.isStart&&(this.time-=e,this.time<=0&&(this.time=0,this.isStart=!1,a.gEventMgr.emit(r.GlobalEvent.GAME_OVER,n.TIME_OUT)))},e.prototype.getTime=function(){return this.time},e}();o.Game=l.inst,cc._RF.pop()},{"../Config/Config":"Config","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../TableMgr":"TableMgr","../exts/HashMap":"HashMap"}],GameScene:[function(e,t,o){"use strict";cc._RF.push(t,"e4483cGN9dC8JpeMWEDWaJe","GameScene"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Controller/GameFactory"),i=e("../Controller/EventManager"),a=e("../Controller/EventName"),r=e("./GameMgr"),s=e("./CubeBg"),c=e("../Config/Config"),l=e("./CubeRoot"),h=cc._decorator,u=h.ccclass,p=h.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.GamePanel=null,t.DragPanel=null,t.Score=null,t.TimeLabel=null,t.TimeProgress=null,t.adjustCount=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;r.Game.start(),this.initEvent(),r.Game.bindGamePanel(this.GamePanel),this.GamePanel.removeAllChildren();for(var t=function(t){o.GamePanel.runAction(cc.sequence(cc.delayTime(t/60),cc.callFunc(function(){e.GamePanel.addChild(n.gFactory.getCubeBg(t))},o)))},o=this,i=0;i<=63;i++)t(i);this.DragPanel.removeAllChildren(),this.onCubePlaceDone()},t.prototype.initEvent=function(){i.gEventMgr.targetOff(this),i.gEventMgr.on(a.GlobalEvent.Cube_ADJUST_DONE,this.adjustDragPanel,this),i.gEventMgr.on(a.GlobalEvent.CUBE_BOX_DRAGING,this.onBoxDrag,this),i.gEventMgr.on(a.GlobalEvent.CUBE_BOX_SET_STATE_DONE,this.onCubePlaceDone,this),i.gEventMgr.on(a.GlobalEvent.UPDATE_SCORE,this.updateScore,this)},t.prototype.updateScore=function(){this.Score.string=r.Game.getScore().toString()},t.prototype.onBoxDrag=function(e,t,o,n,s){var c=e.add(cc.v2(-t.width/2+o.width/2,t.height/2-o.height/2));r.Game.canPlace=this.checkCanPlace(e,c,n,s,!0),r.Game.canPlace||i.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_DRAG_CANCEL)},t.prototype.checkCanPlace=function(e,t,o,n,l){void 0===l&&(l=!1);for(var h=n[0],u=n[1],p=n[2],d=null,g=null,f=0,v=this.GamePanel.children;f<v.length;f++){var m=v[f];d?CMath.Distance(d.position,t)>=CMath.Distance(m.position,t)&&(d=m):CMath.Distance(m.position,t)<=m.width/2*Math.SQRT2&&(d=m)}if(!d)return!1;var y=d.getComponent(s.default).getIndex(),C=y+(u-1)*c.Config.Grid.x+p;if(C%c.Config.Grid.x>=y%c.Config.Grid.x)for(var _=0,b=this.GamePanel.children;_<b.length;_++){if((m=b[_]).getComponent(s.default).getIndex()==C){g=m;break}}if(g){var E=d.getComponent(s.default);if(E){for(var D=[],S=0,x=o;S<x.length;S++){var M=x[S];D.push(E.getIndex()+M)}if(D[0]>=0&&D[D.length-1]<=63){for(var O=null,P=0,A=this.GamePanel.children;P<A.length;P++){if((m=A[P]).getComponent(s.default).getIndex()==D[D.length-1]&&(O=m),!m.getComponent(s.default).isAvailable()&&D.indexOf(m.getComponent(s.default).getIndex())>=0)return!1}return!(!O||g.getComponent(s.default).getIndex()%c.Config.Grid.x-O.getComponent(s.default).getIndex()%c.Config.Grid.x!=h)&&(l&&(i.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_DRAG_INDEX,D),r.Game.canPlace=!0,r.Game.placePos=this.GamePanel.convertToWorldSpaceAR(d.position.sub(t).add(e))),!0)}return!1}return!1}return!1},t.prototype.adjustDragPanel=function(){if(this.adjustCount++,console.log(this.adjustCount),this.adjustCount>=3){this.adjustCount=0;var e=this.DragPanel.children[1],t=this.DragPanel.children[0],o=this.DragPanel.children[2];e.x=0;var n=this.DragPanel.width/2;t.x=.6*n,o.x=.6*-n,i.gEventMgr.emit(a.GlobalEvent.DRAG_ADJUST_DONE)}},t.prototype.genNewDragShape=function(e){for(var t=0,o=e;t<o.length;t++){var i=o[t];this.DragPanel.addChild(n.gFactory.getCubeRoot(i))}},t.prototype.onCubePlaceDone=function(){if(r.Game.check(),this.DragPanel.childrenCount<=0)this.genNewDragShape(r.Game.getShapes());else{for(var e=!0,t=0,o=this.DragPanel.children;t<o.length;t++)for(var n=o[t].getComponent(l.default),i=0,a=this.GamePanel.children;i<a.length;i++){var c=a[i];if(c.getComponent(s.default).isAvailable()&&this.checkCanPlace(c.position,c.position,n.getShape(),n.getInfo())){e=!1;break}}e&&r.Game.gameOver(r.OverType.NO_PLACE)}},t.prototype.update=function(e){r.Game.update(e),this.updateTime()},t.prototype.updateTime=function(){this.TimeLabel.string=CMath.TimeFormat(r.Game.getTime()),this.TimeProgress.progress=r.Game.getTime()/c.Config.GameTime},__decorate([p(cc.Node)],t.prototype,"GamePanel",void 0),__decorate([p(cc.Node)],t.prototype,"DragPanel",void 0),__decorate([p(cc.Label)],t.prototype,"Score",void 0),__decorate([p(cc.Label)],t.prototype,"TimeLabel",void 0),__decorate([p(cc.ProgressBar)],t.prototype,"TimeProgress",void 0),t=__decorate([u],t)}(cc.Component);o.default=d,cc._RF.pop()},{"../Config/Config":"Config","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../Controller/GameFactory":"GameFactory","./CubeBg":"CubeBg","./CubeRoot":"CubeRoot","./GameMgr":"GameMgr"}],HashMap:[function(e,t,o){"use strict";cc._RF.push(t,"65ec9+rOt5Kur9SeJbgRgUM","HashMap"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this._list=new Array,this.clear()}return e.prototype.getIndexByKey=function(e){for(var t=this._list.length,o=0;o<t;o++){if(this._list[o].key==e)return o}return-1},Object.defineProperty(e.prototype,"keys",{get:function(){for(var e=new Array,t=0,o=this._list;t<o.length;t++){var n=o[t];n&&e.push(n.key)}return e},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var o={key:e,value:t},n=this.getIndexByKey(e);-1!=n?this._list[n]=o:this._list.push(o)},Object.defineProperty(e.prototype,"values",{get:function(){return this._list},enumerable:!0,configurable:!0}),e.prototype.remove=function(e){var t=this.getIndexByKey(e);if(-1!=t){var o=this._list[t];return this._list.splice(t,1),o}return null},e.prototype.has=function(e){return-1!=this.getIndexByKey(e)},e.prototype.get=function(e){var t=this.getIndexByKey(e);return-1!=t?this._list[t].value:null},Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!0,configurable:!0}),e.prototype.sort=function(e){this._list.sort(e)},e.prototype.forEachKeyValue=function(e){for(var t=this._list.length,o=0;o<t;o++){e(this._list[o])}},e.prototype.forEach=function(e){for(var t=this._list.length,o=0;o<t;o++){var n=this._list[o];e(n.key,n.value)}},e.prototype.clear=function(){this._list=[]},e}();o.HashMap=n,cc._RF.pop()},{}],OverWindowBinder:[function(e,t,o){"use strict";cc._RF.push(t,"aa2ee5OmJRDj7s00KSFN+Qa","OverWindowBinder"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){}return e.bindAll=function(){},e}();o.default=n,cc._RF.pop()},{}],TableMgr:[function(e,t,o){"use strict";cc._RF.push(t,"33c73L3v+BDpLtcNY7gOVEB","TableMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this.load=e.JSON_URL&&""!=e.JSON_URL?cc.loader.load.bind(cc.loader):cc.loader.loadRes.bind(cc.loader),this.fileFormat=e.JSON_URL&&""!=e.JSON_URL?".json?time="+Date.now():"",this.total=0,this.complete=0,this.Fruits={},this.Shape={},this.ShapeWeight={}}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.startLoad=function(t,o,n){this.completeCallback=o,this.progressCallback=n;var i=this;console.log("Base URL:",e.JSON_URL),this.load(e.JSON_URL+t.trim().split("/").join("")+"/file_list"+this.fileFormat,function(e,o){if(e)console.error(e.errorMessage);else{var n="Array"==o.constructor.name?o:o.json;this.total=n.length;for(var a=0,r=n;a<r.length;a++){var s=r[a];i.loadJson(t.trim().split("/").join("")+"/"+s.replace(".json",""))}}}.bind(this))},e.prototype.loadJson=function(t){console.log("start load:"+t);var o=this,n=t.split("/")[1];n=n.charAt(0).toUpperCase()+n.slice(1,n.length),this.load(e.JSON_URL+t+this.fileFormat,function(e,t){if(e)console.error(e.errorMessage);else{for(var i=0,a="Array"==t.constructor.name?t:t.json;i<a.length;i++){var r=a[i];o[n][r.ID]=r}o.completeLoad()}}.bind(this))},e.prototype.completeLoad=function(){this.complete++,this.complete>=this.total&&this.completeCallback&&this.completeCallback()},e.prototype.getFruits=function(e){return this.Fruits[e]?this.Fruits[e]:(console.error("Fruits \u4e0d\u5b58key\uff1a"+e),null)},e.prototype.getAll_Fruits_Data=function(){return this.Fruits},e.prototype.getShape=function(e){return this.Shape[e]?this.Shape[e]:(console.error("Shape \u4e0d\u5b58key\uff1a"+e),null)},e.prototype.getAll_Shape_Data=function(){return this.Shape},e.prototype.getShapeWeight=function(e){return this.ShapeWeight[e]?this.ShapeWeight[e]:(console.error("ShapeWeight \u4e0d\u5b58key\uff1a"+e),null)},e.prototype.getAll_ShapeWeight_Data=function(){return this.ShapeWeight},e.JSON_URL="",e}();o.TableMgr=n,cc._RF.pop()},{}],UIManager:[function(e,t,o){"use strict";cc._RF.push(t,"77177WRAQdM2bTfZ/1vIPzs","UIManager"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../exts/HashMap"),i=e("../UI/export/Game/GameBinder"),a=e("../UI/export/OverWindow/OverWindowBinder"),r=cc._decorator.ccclass,s=function(){function e(){this.isInit=!1,this.guiMap=new n.HashMap,this.windowMap=new n.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(){fgui.addLoadHandler(),cc.view.setResizeCallback(this.onResize.bind(this)),cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,function(){fgui.GRoot.create(),console.info("########################### fgui.GRoot.create ###########################")},this),this.isInit=!0},e.prototype.loadUIPackage=function(e){console.warn(" start load loadUIPackage "),this.isInit||this.init(),this.windowMap.clear(),this.guiMap.clear(),fgui.UIPackage._instById={},cc.loader.loadResDir("UI/sync",function(t,o,n){if(console.log(n),t)e(t);else{for(var r=0,s=n;r<s.length;r++){var c=s[r];/atlas/.test(c)||fgui.UIPackage.addPackage(c)}i.default.bindAll(),a.default.bindAll(),e(null)}})},e.prototype.onResize=function(){var e=cc.view.getCanvasSize();e.width/=cc.view.getScaleX(),e.height/=cc.view.getScaleY(),this.guiMap.forEach(function(t,o){o.setPosition((e.width-o.width)/2,(e.height-o.height)/2)}),this.windowMap.forEach(function(t,o){o.setPosition((e.width-o.width)/2,(e.height-o.height)/2)})},e.prototype.openGUI=function(e,t){var o=this.guiMap.get(e.URL);if(o){var n=o.node.getComponent(t);return o.node.active?console.warn("UI is showed:"+e.URL):n.show(),n}var i=e.createInstanceSync();return i.setPosition((fgui.GRoot.inst.width-i.width)/2,(fgui.GRoot.inst.height-i.height)/2),fgui.GRoot.inst.addChild(i),this.guiMap.add(e.URL,i),i.node.addComponent(t).register(i).show()},e.prototype.closeGUI=function(e,t){var o=this.guiMap.get(e.URL);return o?o.node.getComponent(t).hide():(console.error("UI not exist:"+e.URL),null)},e.prototype.openWindow=function(e,t){var o=this,n=this.windowMap.get(e.URL);if(n){var i=n.node.getComponent(t);n.node.active?console.warn("UI is showed:"+e.URL):i.show()}else e.createInstance(function(n){var i=new fgui.Window;i.contentPane=n,i.modal=!0,i.show(),i.setPosition((fgui.GRoot.inst.width-i.width)/2,(fgui.GRoot.inst.height-i.height)/2),o.windowMap.add(e.URL,i),i.node.addComponent(t).register(n).show()})},e.prototype.closeWindow=function(e,t,o){void 0===o&&(o=!0);var n=this.windowMap.get(e.URL);if(!n)return console.error("UI not exist:"+e.URL),!1;n.hide();var i=n.node.getComponent(t).hide(o);return o&&e.releaseInstance(),this.windowMap.remove(e.URL),i},e}();o.UIMgr=s.inst;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onShow=function(){},t.prototype.onHide=function(){},t.prototype.show=function(){return this.node.isValid?(this.node.active||(this.node.active=!0),this.onShow(),this):(console.error(" node valid!"),this)},t.prototype.hide=function(e){return void 0===e&&(e=!1),this.node.isValid?(this.node.active&&(this.node.active=!1),this.onHide(),e&&this.node.removeFromParent(e),!0):(console.error(" node valid!"),!1)},t=__decorate([r],t)}(cc.Component);o.BaseUI=c,cc._RF.pop()},{"../UI/export/Game/GameBinder":"GameBinder","../UI/export/OverWindow/OverWindowBinder":"OverWindowBinder","../exts/HashMap":"HashMap"}],WelcomeScene:[function(e,t,o){"use strict";cc._RF.push(t,"cc976drFj5NmKgolSm1G3Qa","WelcomeScene"),Object.defineProperty(o,"__esModule",{value:!0});var n,i=e("../TableMgr"),a=e("../Controller/AudioController"),r=e("../Controller/UIManager"),s=e("../Controller/GameFactory"),c=e("../Config/Config"),l=e("../exts/celerx"),h=cc._decorator,u=h.ccclass,p=h.property;(function(e){e[e.READY=2]="READY",e[e.INIT=4]="INIT",e[e.REGISTER=8]="REGISTER",e[e.LOGIN=16]="LOGIN",e[e.MATCH=32]="MATCH",e[e.JSON_PARSE=64]="JSON_PARSE",e[e.ANIMATION_DONE=128]="ANIMATION_DONE",e[e.SCENE_DONE=256]="SCENE_DONE",e[e.AUDIO=512]="AUDIO",e[e.UI=1024]="UI",e[e.DONE=2046]="DONE"})(n=o.LOAD_STEP||(o.LOAD_STEP={}));var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nextSceneName="game",t.percentLabel=null,t.maxPercent=0,t.curPercent=0,t._step=n.READY,t.startTime=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;l.start();var t=l.getMatch();t&&t.sharedRandomSeed?CMath.randomSeed=t.sharedRandomSeed:CMath.randomSeed=Date.now(),this.startTime=Date.now(),cc.game.setFrameRate(c.Config.FPS),this.maxPercent=0,this.defaultAnimation=this.node.getComponent(cc.Animation),this.defaultAnimation?this.defaultAnimation.once(cc.Animation.EventType.FINISHED,this.animationDone,this):this.nextStep(n.ANIMATION_DONE),c.Config.isMultiPlayer||(this.nextStep(n.LOGIN),this.nextStep(n.MATCH),this.nextStep(n.REGISTER),this.nextStep(n.INIT)),cc.loader.loadResDir("Textures/Fruits/"),i.TableMgr.inst.startLoad("json/",function(){s.gFactory.init(function(){this.nextStep(n.JSON_PARSE)}.bind(e))}),a.gAudio.init(function(){this.nextStep(n.AUDIO)}.bind(this)),cc.director.preloadScene(this.nextSceneName,null,function(t,o){t?console.error("\u573a\u666f\u52a0\u8f7d\u9519\u8bef"):(e.nextScene=o.scene,e.nextStep(n.SCENE_DONE))}),r.UIMgr.loadUIPackage(function(t){t?console.error("UI \u52a0\u8f7d\u9519\u8bef:",t):e.nextStep(n.UI)})},t.prototype.update=function(e){this.curPercent+=e,this.curPercent>=this.maxPercent&&(this.curPercent=this.maxPercent),this.percentLabel.string=(100*this.curPercent).toFixed(2)+"%",this.curPercent>=1&&this.node.emit("load_done")},t.prototype.animationDone=function(){this.defaultAnimation.off(cc.Animation.EventType.FINISHED),this.nextStep(n.ANIMATION_DONE)},t.prototype.nextStep=function(e){var t=this;this.calLoadTime(e),this._step|=e,e!=n.ANIMATION_DONE&&console.log("CUR STEP:"+n[e]+", total: "+this._step),this.maxPercent=(this._step&(65535^n.ANIMATION_DONE))/(n.DONE&(65535^n.ANIMATION_DONE)),this._step>=n.DONE?(this.node.once("load_done",function(){t.nextScene?cc.director.runSceneImmediate(t.nextScene):cc.director.loadScene(t.nextSceneName)},this),this.defaultAnimation&&(this.defaultAnimation.play().wrapMode=cc.WrapMode.Loop)):e==n.ANIMATION_DONE&&this.defaultAnimation&&(this._step&=65535^n.ANIMATION_DONE,this.defaultAnimation.once(cc.Animation.EventType.FINISHED,this.animationDone,this),this.defaultAnimation.play())},t.prototype.calLoadTime=function(e){switch(e){case n.AUDIO:console.warn(" audio cost time:",Date.now()-this.startTime,"ms");break;case n.JSON_PARSE:console.warn(" table cost time:",Date.now()-this.startTime,"ms");break;case n.UI:console.warn(" UI cost time:",Date.now()-this.startTime,"ms");break;case n.SCENE_DONE:console.warn(" Scene cost time:",Date.now()-this.startTime,"ms")}},__decorate([p({displayName:"\u6e38\u620f\u573a\u666f\u540d",tooltip:"\u9ed8\u8ba4\u8fdb\u5165game\u573a\u666f\uff0c\u5982\u679c\u9700\u8981\u6307\u5b9a\u573a\u666f\uff0c\u53ef\u4ee5\u6307\u5b9a"})],t.prototype,"nextSceneName",void 0),__decorate([p(cc.Label)],t.prototype,"percentLabel",void 0),t=__decorate([u],t)}(cc.Component);o.default=d,cc._RF.pop()},{"../Config/Config":"Config","../Controller/AudioController":"AudioController","../Controller/GameFactory":"GameFactory","../Controller/UIManager":"UIManager","../TableMgr":"TableMgr","../exts/celerx":"celerx"}],celerx:[function(e,t,o){"use strict";cc._RF.push(t,"5fb9cBc1OBEM5BpUwBtd5fb","celerx");var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e){for(var t=new Uint8Array(e),o=new Array,n=0,i=0,a=new Array(3),r=new Array(4),s=t.length,l=0;s--;)if(a[n++]=t[l++],3==n){for(r[0]=(252&a[0])>>2,r[1]=((3&a[0])<<4)+((240&a[1])>>4),r[2]=((15&a[1])<<2)+((192&a[2])>>6),r[3]=63&a[2],n=0;n<4;n++)o+=c.charAt(r[n]);n=0}if(n){for(i=n;i<3;i++)a[i]=0;for(r[0]=(252&a[0])>>2,r[1]=((3&a[0])<<4)+((240&a[1])>>4),r[2]=((15&a[1])<<2)+((192&a[2])>>6),r[3]=63&a[2],i=0;i<n+1;i++)o+=c.charAt(r[i]);for(;n++<3;)o+="="}return o}function a(e){var t,o,n,i,a,r,s=new Array,c=0;if(e!=(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""))&&alert("Warning! Characters outside Base64 range in input string ignored."),e.length%4)return alert("Error: Input length is not a multiple of 4 bytes."),"";for(var h=0;c<e.length;)t=l.indexOf(e.charAt(c++))<<2|(i=l.indexOf(e.charAt(c++)))>>4,o=(15&i)<<4|(a=l.indexOf(e.charAt(c++)))>>2,n=(3&a)<<6|(r=l.indexOf(e.charAt(c++))),s[h++]=t,64!=a&&(s[h++]=o),64!=r&&(s[h++]=n);return s}var r="function"==typeof Symbol&&"symbol"==n(Symbol.iterator)?function(e){return void 0===e?"undefined":n(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":n(e)},s={default:void 0,call:function(e,t,o){var n="";if("function"==typeof t&&(o=t,t={}),t={data:void 0===t?null:t},"function"==typeof o){var i="dscb"+window.dscb++;window[i]=o,t._dscbstub=i}return t=JSON.stringify(t),window._dsbridge?n=_dsbridge.call(e,t):(window._dswk||-1!=navigator.userAgent.indexOf("_dsbridge"))&&(n=prompt("_dsbridge="+e,t)),JSON.parse(n||"{}").data},register:function(e,t,o){o=o?window._dsaf:window._dsf,window._dsInit||(window._dsInit=!0,setTimeout(function(){s.call("_dsb.dsinit")},0)),"object"==(void 0===t?"undefined":r(t))?o._obs[e]=t:o[e]=t},registerAsyn:function(e,t){this.register(e,t,!0)},hasNativeMethod:function(e,t){return this.call("_dsb.hasNativeMethod",{name:e,type:t||"all"})},disableJavascriptDialogBlock:function(e){this.call("_dsb.disableJavascriptDialogBlock",{disable:!1!==e})}};!function(){if(!window._dsf){var e,t={_dsf:{_obs:{}},_dsaf:{_obs:{}},dscb:0,celerx:s,close:function(){s.call("_dsb.closePage")},_handleMessageFromNative:function(e){var t=JSON.parse(e.data),o={id:e.callbackId,complete:!0},n=this._dsf[e.method],i=this._dsaf[e.method],a=function(e,n){o.data=e.apply(n,t),s.call("_dsb.returnValue",o)},r=function(e,n){t.push(function(e,t){o.data=e,o.complete=!1!==t,s.call("_dsb.returnValue",o)}),e.apply(n,t)};if(n)a(n,this._dsf);else if(i)r(i,this._dsaf);else if(!(2>(n=e.method.split(".")).length)){e=n.pop();n=n.join(".");var c=(i=(i=this._dsf._obs)[n]||{})[e];c&&"function"==typeof c?a(c,i):(c=(i=(i=this._dsaf._obs)[n]||{})[e])&&"function"==typeof c&&r(c,i)}}};for(e in t)window[e]=t[e];s.register("_hasJavascriptMethod",function(e,t){return 2>(t=e.split(".")).length?!(!_dsf[t]&&!_dsaf[t]):(e=t.pop(),t=t.join("."),(t=_dsf._obs[t]||_dsaf._obs[t])&&!!t[e])})}}();var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.exports={onStateReceived:function(e){return s.register("onStateReceived",function(t){var o=a(t);return e(new Uint8Array(o))})},onCourtModeStarted:function(e){return s.register("onCourtModeStarted",e)},getMatch:function(){var e=s.call("getMatch","123");try{e=JSON.parse(e)}catch(e){}return e},showCourtModeDialog:function(){return s.call("showCourtModeDialog")},start:function(){return s.call("start")},sendState:function(e){return s.call("sendState",i(e))},draw:function(e){return s.call("draw",i(e))},win:function(e){return s.call("win",i(e))},lose:function(e){return s.call("lose",i(e))},surrender:function(e){return s.call("surrender",i(e))},applyAction:function(e,t){return s.call("applyAction",i(e),t)},getOnChainState:function(e){return s.call("getOnChainState","123",function(t){var o=a(t);return e(new Uint8Array(o))})},getOnChainActionDeadline:function(e){return s.call("getOnChainActionDeadline","123",e)},getCurrentBlockNumber:function(){return s.call("getCurrentBlockNumber","123")},finalizeOnChainGame:function(e){return s.call("finalizeOnChainGame","123",e)},submitScore:function(e){return s.call("submitScore",e)}},cc._RF.pop()},{}],table:[function(e,t,o){"use strict";cc._RF.push(t,"adcebipSrZMgb1UHOlwts9Z","table"),Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.PuTongFangKuai=1]="PuTongFangKuai",e[e.TeShuDaoJu=2]="TeShuDaoJu"}(o.Shape_Type||(o.Shape_Type={})),cc._RF.pop()},{}]},{},["Config","AudioController","EventManager","EventName","GameFactory","UIManager","Cube","CubeBg","CubeRoot","GameMgr","GameScene","WelcomeScene","TableMgr","GameBinder","OverWindowBinder","HashMap","celerx","table"]);